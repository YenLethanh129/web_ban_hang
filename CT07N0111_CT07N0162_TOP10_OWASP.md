# üë§ CT07N0111 - M·∫†CH TI·∫æN DUY - CT07N0162 - L√ä THANH Y√äN

# üîí OWASP API Security Top 10 - 2023 & Checklist √Åp D·ª•ng Th·ª±c T·∫ø

## üìã T√≥m T·∫Øt Executive

**OWASP API Security Top 10 - 2023** l√† b·∫£n c·∫≠p nh·∫≠t m·ªõi nh·∫•t t·∫≠p trung v√†o c√°c r·ªßi ro b·∫£o m·∫≠t API, ph√π h·ª£p v·ªõi xu h∆∞·ªõng ph√°t tri·ªÉn ·ª©ng d·ª•ng hi·ªán ƒë·∫°i s·ª≠ d·ª•ng ki·∫øn tr√∫c microservices v√† API-first. T√†i li·ªáu n√†y ƒë∆∞·ª£c vi·∫øt l·∫°i ƒë·ªÉ √°p d·ª•ng tr·ª±c ti·∫øp v√†o d·ª± √°n **Angular + Spring Boot** e-commerce c·ªßa ch√∫ng ta.

### üéØ M·ª•c Ti√™u D·ª± √Ån

- √Åp d·ª•ng OWASP API Security Top 10 - 2023 v√†o website th∆∞∆°ng m·∫°i ƒëi·ªán t·ª≠
- T·∫°o checklist c·ª• th·ªÉ cho Spring Boot backend + Angular frontend
- ∆Øu ti√™n c√°c r·ªßi ro ph√π h·ª£p v·ªõi nghi·ªáp v·ª• b√°n h√†ng tr·ª±c tuy·∫øn

## üö® OWASP API Security Top 10 - 2023

### API1:2023 - Broken Object Level Authorization (BOLA)

**üìä M·ª©c ƒê·ªô R·ªßi Ro**: üî¥ C·ª±c Cao  
**üéØ ·ª®ng D·ª•ng E-Commerce**: Truy c·∫≠p ƒë∆°n h√†ng, th√¥ng tin kh√°ch h√†ng c·ªßa ng∆∞·ªùi kh√°c

#### M√¥ T·∫£

APIs th∆∞·ªùng expose endpoints x·ª≠ l√Ω object identifiers, t·∫°o ra b·ªÅ m·∫∑t t·∫•n c√¥ng r·ªông v·ªÅ Object Level Access Control. C·∫ßn ki·ªÉm tra authorization ·ªü m·ªçi function truy c·∫≠p data source b·∫±ng ID t·ª´ user.

#### V√≠ D·ª• Trong D·ª± √Ån Coffee Shop

```java
// ‚ùå KH√îNG AN TO√ÄN: Kh√¥ng ki·ªÉm tra ownership
@GetMapping("/api/orders/{orderId}")
public ResponseEntity<OrderDTO> getOrder(@PathVariable Long orderId) {
    Order order = orderService.findById(orderId);
    return ResponseEntity.ok(orderMapper.toDTO(order));
}

// ‚úÖ AN TO√ÄN: Ki·ªÉm tra ownership
@GetMapping("/api/orders/{orderId}")
public ResponseEntity<OrderDTO> getOrder(
    @PathVariable Long orderId,
    Authentication auth
) {
    User currentUser = userService.getCurrentUser(auth);
    Order order = orderService.findByIdAndUserId(orderId, currentUser.getId());
    if (order == null) {
        throw new AccessDeniedException("Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p ƒë∆°n h√†ng n√†y");
    }
    return ResponseEntity.ok(orderMapper.toDTO(order));
}
```

#### üìù Checklist Tri·ªÉn Khai

**Backend (Spring Boot):**

- [ ] Implement `@PreAuthorize` cho m·ªçi API endpoint
- [ ] Ki·ªÉm tra `userId` trong token JWT v·ªõi `ownerId` c·ªßa resource
- [ ] T·∫°o `BaseController` v·ªõi method `validateOwnership()`
- [ ] Audit log m·ªçi truy c·∫≠p th·∫•t b·∫°i

**Frontend (Angular):**

- [ ] Kh√¥ng hi·ªÉn th·ªã data n·∫øu kh√¥ng c√≥ quy·ªÅn
- [ ] Guard routes d·ª±a tr√™n role/permission
- [ ] Hide UI elements kh√¥ng ph√π h·ª£p v·ªõi role

```typescript
// Angular Guard Example
@Injectable()
export class OrderGuard implements CanActivate {
  canActivate(route: ActivatedRouteSnapshot): boolean {
    const orderId = route.params["id"];
    const currentUserId = this.authService.getCurrentUser()?.id;
    // Check if order belongs to current user
    return this.orderService.validateOwnership(orderId, currentUserId);
  }
}
```

---

### API2:2023 - Broken Authentication

**üìä M·ª©c ƒê·ªô R·ªßi Ro**: üî¥ Cao  
**üéØ ·ª®ng D·ª•ng E-Commerce**: Chi·∫øm ƒëo·∫°t t√†i kho·∫£n, th√¥ng tin thanh to√°n

#### M√¥ T·∫£

Authentication mechanisms th∆∞·ªùng ƒë∆∞·ª£c implement sai, cho ph√©p attackers compromise authentication tokens ho·∫∑c khai th√°c implementation flaws ƒë·ªÉ assume other user's identities.

#### V√≠ D·ª• Trong D·ª± √Ån

```java
// ‚ùå KH√îNG AN TO√ÄN: Weak JWT
@PostMapping("/login")
public ResponseEntity<LoginResponse> login(@RequestBody LoginRequest request) {
    // Weak secret, no expiration
    String token = Jwts.builder()
        .setSubject(user.getUsername())
        .signWith(SignatureAlgorithm.HS256, "weakSecret123")
        .compact();
    return ResponseEntity.ok(new LoginResponse(token));
}

// ‚úÖ AN TO√ÄN: Strong JWT with proper config
@PostMapping("/login")
public ResponseEntity<LoginResponse> login(@RequestBody LoginRequest request) {
    User user = authService.authenticate(request.getUsername(), request.getPassword());

    String token = Jwts.builder()
        .setSubject(user.getUsername())
        .setIssuedAt(new Date())
        .setExpiration(new Date(System.currentTimeMillis() + jwtExpiration))
        .claim("role", user.getRole())
        .claim("userId", user.getId())
        .signWith(SignatureAlgorithm.HS512, jwtSecret) // Strong algorithm & secret
        .compact();

    // Set HttpOnly cookie for better security
    ResponseCookie cookie = ResponseCookie.from("token", token)
        .httpOnly(true)
        .secure(true)
        .sameSite("Strict")
        .maxAge(Duration.ofHours(24))
        .build();

    return ResponseEntity.ok()
        .header(HttpHeaders.SET_COOKIE, cookie.toString())
        .body(new LoginResponse("success"));
}
```

#### üìù Checklist Tri·ªÉn Khai

**Backend (Spring Boot):**

- [ ] S·ª≠ d·ª•ng strong JWT secret (environment variable)
- [ ] Implement JWT expiration v√† refresh token
- [ ] Rate limiting cho login attempts
- [ ] Account lockout sau failed attempts
- [ ] 2FA cho admin accounts
- [ ] Secure password policies (BCrypt v·ªõi cost factor ‚â• 12)

**Frontend (Angular):**

- [ ] Store tokens trong HttpOnly cookies (kh√¥ng localStorage)
- [ ] Auto redirect v·ªÅ login khi token expired
- [ ] Implement captcha sau failed attempts
- [ ] Clear session data khi logout

````typescript
// Angular Auth Service Example
@Injectable()
export class AuthService {
  private readonly MAX_FAILED_ATTEMPTS = 3;
  private failedAttempts = 0;

  login(credentials: LoginRequest): Observable<LoginResponse> {
    return this.http.post<LoginResponse>('/api/auth/login', credentials)
      .pipe(
        tap(() => this.failedAttempts = 0),
        catchError(error => {
          this.failedAttempts++;
          if (this.failedAttempts >= this.MAX_FAILED_ATTEMPTS) {
            this.captchaService.enableCaptcha();
          }
          return throwError(error);
        })
      );
  }
}
---

### API3:2023 - Broken Object Property Level Authorization

**üìä M·ª©c ƒê·ªô R·ªßi Ro**: üî¥ Cao
**üéØ ·ª®ng D·ª•ng E-Commerce**: L·ªô th√¥ng tin nh·∫°y c·∫£m trong API response, mass assignment attacks

#### M√¥ T·∫£
K·∫øt h·ª£p API3:2019 Excessive Data Exposure v√† API6:2019 Mass Assignment. T·∫≠p trung v√†o nguy√™n nh√¢n g·ªëc: thi·∫øu ho·∫∑c ki·ªÉm tra authorization kh√¥ng ƒë√∫ng ·ªü object property level.

#### V√≠ D·ª• Trong D·ª± √Ån

```
// ‚ùå KH√îNG AN TO√ÄN: Tr·∫£ v·ªÅ to√†n b·ªô User entity
@GetMapping("/api/users/profile")
public ResponseEntity<User> getUserProfile(Authentication auth) {
    User user = userService.findByUsername(auth.getName());
    return ResponseEntity.ok(user); // L·ªô password hash, role, internal IDs!
}
```
// ‚ùå KH√îNG AN TO√ÄN: Mass assignment
@PutMapping("/api/users/profile")
public ResponseEntity<User> updateProfile(@RequestBody User updateUser) {
    userService.update(updateUser); // C√≥ th·ªÉ change role, isActive, etc.
    return ResponseEntity.ok(updateUser);
}

// ‚úÖ AN TO√ÄN: S·ª≠ d·ª•ng DTO ri√™ng cho t·ª´ng role
@GetMapping("/api/users/profile")
public ResponseEntity<UserProfileDTO> getUserProfile(Authentication auth) {
    User user = userService.findByUsername(auth.getName());
    UserProfileDTO dto = userMapper.toProfileDTO(user); // Ch·ªâ fullname, email, phone
    return ResponseEntity.ok(dto);
}

// ‚úÖ AN TO√ÄN: Explicit fields cho update
@PutMapping("/api/users/profile")
public ResponseEntity<UserProfileDTO> updateProfile(
    @RequestBody @Valid UpdateUserProfileRequest request,
    Authentication auth
) {
    User user = userService.findByUsername(auth.getName());
    user.setFullname(request.getFullname());
    user.setAddress(request.getAddress());
    // Kh√¥ng cho ph√©p thay ƒë·ªïi role, email, etc.
    userService.save(user);
    return ResponseEntity.ok(userMapper.toProfileDTO(user));
}
````

#### üìù Checklist Tri·ªÉn Khai

**Backend (Spring Boot):**

- [ ] T·∫°o separate DTOs cho t·ª´ng endpoint v√† role
- [ ] Kh√¥ng tr·∫£ v·ªÅ Entity tr·ª±c ti·∫øp t·ª´ API
- [ ] Validate t·∫•t c·∫£ input fields explicitly
- [ ] Use `@JsonIgnore` cho sensitive fields
- [ ] Implement field-level authorization

**Frontend (Angular):**

- [ ] Validate data received t·ª´ API
- [ ] Hide sensitive fields d·ª±a tr√™n role
- [ ] Kh√¥ng g·ª≠i extra fields trong request

```typescript
// Angular DTO Examples
export interface CustomerProfileDTO {
  id: number;
  fullname: string;
  email: string;
  phone: string;
  address: string;
  // Kh√¥ng c√≥ role, permissions, isActive, etc.
}

export interface AdminUserDTO extends CustomerProfileDTO {
  role: string;
  isActive: boolean;
  createdAt: Date;
  lastLogin: Date;
  // Ch·ªâ admin m·ªõi th·∫•y ƒë∆∞·ª£c
}
```

---

### API4:2023 - Unrestricted Resource Consumption

**üìä M·ª©c ƒê·ªô R·ªßi Ro**: üü† Trung B√¨nh-Cao  
**üéØ ·ª®ng D·ª•ng E-Commerce**: DoS attacks, tƒÉng chi ph√≠ operational

#### M√¥ T·∫£

API requests c·∫ßn resources nh∆∞ network bandwidth, CPU, memory, storage. Successful attacks c√≥ th·ªÉ d·∫´n ƒë·∫øn Denial of Service ho·∫∑c tƒÉng operational costs.

#### V√≠ D·ª• Trong D·ª± √Ån

```java
// ‚ùå KH√îNG AN TO√ÄN: Kh√¥ng gi·ªõi h·∫°n k√≠ch th∆∞·ªõc result
@GetMapping("/api/products")
public ResponseEntity<List<ProductDTO>> getProducts(
    @RequestParam(defaultValue = "0") int page,
    @RequestParam(defaultValue = "1000000") int size // Nguy hi·ªÉm!
) {
    List<Product> products = productService.findAll(page, size);
    return ResponseEntity.ok(productMapper.toDTOList(products));
}

// ‚úÖ AN TO√ÄN: Gi·ªõi h·∫°n v√† validate input
@GetMapping("/api/products")
public ResponseEntity<PagedResponse<ProductDTO>> getProducts(
    @RequestParam(defaultValue = "0") @Min(0) int page,
    @RequestParam(defaultValue = "20") @Min(1) @Max(100) int size
) {
    Pageable pageable = PageRequest.of(page, size);
    Page<Product> products = productService.findAll(pageable);
    return ResponseEntity.ok(PagedResponse.of(products, productMapper::toDTO));
}

// ‚ùå KH√îNG AN TO√ÄN: File upload kh√¥ng gi·ªõi h·∫°n
@PostMapping("/api/products/image")
public ResponseEntity<String> uploadImage(@RequestParam("file") MultipartFile file) {
    String url = fileService.upload(file); // C√≥ th·ªÉ upload file 1GB!
    return ResponseEntity.ok(url);
}

// ‚úÖ AN TO√ÄN: Gi·ªõi h·∫°n size v√† type
@PostMapping("/api/products/image")
public ResponseEntity<String> uploadImage(
    @RequestParam("file") MultipartFile file
) {
    // Validate file size (max 5MB)
    if (file.getSize() > 5 * 1024 * 1024) {
        throw new FileTooLargeException("File kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° 5MB");
    }

    // Validate file type
    String contentType = file.getContentType();
    if (!Arrays.asList("image/jpeg", "image/png", "image/webp").contains(contentType)) {
        throw new InvalidFileTypeException("Ch·ªâ ch·∫•p nh·∫≠n JPG, PNG, WebP");
    }

    String url = fileService.upload(file);
    return ResponseEntity.ok(url);
}
```

#### üìù Checklist Tri·ªÉn Khai

**Backend (Spring Boot):**

- [ ] Implement pagination cho m·ªçi list endpoints
- [ ] Set maximum page size (‚â§ 100 items)
- [ ] Rate limiting per IP/user (Spring Cloud Gateway, bucket4j)
- [ ] File upload size limits
- [ ] Request timeout configuration
- [ ] Database query timeout
- [ ] Memory usage monitoring

**Frontend (Angular):**

- [ ] Lazy loading cho large lists
- [ ] Virtual scrolling cho infinite scroll
- [ ] Cancel pending requests khi navigate away
- [ ] Show loading states v√† progress bars
- [ ] Warn user v·ªÅ large downloads

```typescript
// Angular Virtual Scrolling Example
export class ProductListComponent {
  products$ = this.productService.getProductsPaginated();

  // Virtual scrolling ƒë·ªÉ handle large lists
  trackByFn = (index: number, item: Product) => item.id;

  onScroll(event: CdkScrollable) {
    // Load more khi scroll g·∫ßn cu·ªëi
    if (this.isNearBottom(event)) {
      this.loadMore();
    }
  }

  private loadMore() {
    if (!this.loading && this.hasMore) {
      this.loading = true;
      this.productService.loadNextPage();
    }
  }
}
```

---

### API5:2023 - Broken Function Level Authorization

**üìä M·ª©c ƒê·ªô R·ªßi Ro**: üî¥ Cao  
**üéØ ·ª®ng D·ª•ng E-Commerce**: User th∆∞·ªùng truy c·∫≠p admin functions, seller manage products c·ªßa ng∆∞·ªùi kh√°c

#### M√¥ T·∫£

Complex access control policies v·ªõi different hierarchies, groups, roles d·∫´n ƒë·∫øn authorization flaws. Attackers c√≥ th·ªÉ gain access to other users' resources v√†/ho·∫∑c administrative functions.

#### V√≠ D·ª• Trong D·ª± √Ån

```java
// ‚ùå KH√îNG AN TO√ÄN: Kh√¥ng ki·ªÉm tra function-level permission
@RestController
@RequestMapping("/api")
public class ProductController {

    @PostMapping("/admin/products") // Ch·ªâ d·ª±a v√†o URL path!
    public ResponseEntity<Product> createProduct(@RequestBody ProductRequest request) {
        Product product = productService.create(request);
        return ResponseEntity.ok(product);
    }

    @DeleteMapping("/products/{id}")
    public ResponseEntity<?> deleteProduct(@PathVariable Long id) {
        productService.delete(id); // Ai c≈©ng c√≥ th·ªÉ x√≥a!
        return ResponseEntity.ok().build();
    }
}

// ‚úÖ AN TO√ÄN: Function-level authorization
@RestController
@RequestMapping("/api")
@PreAuthorize("hasRole('USER')") // Base permission
public class ProductController {

    @PostMapping("/admin/products")
    @PreAuthorize("hasRole('ADMIN') or hasRole('SELLER')")
    public ResponseEntity<Product> createProduct(
        @RequestBody @Valid ProductRequest request,
        Authentication auth
    ) {
        User currentUser = userService.getCurrentUser(auth);

        // Ki·ªÉm tra additional business rules
        if (currentUser.getRole() == Role.SELLER) {
            request.setSellerId(currentUser.getId()); // Ch·ªâ t·∫°o cho ch√≠nh m√¨nh
        }

        Product product = productService.create(request, currentUser);
        return ResponseEntity.ok(product);
    }

    @DeleteMapping("/products/{id}")
    @PreAuthorize("hasRole('ADMIN') or @productService.isOwner(#id, authentication.name)")
    public ResponseEntity<?> deleteProduct(@PathVariable Long id, Authentication auth) {
        productService.delete(id);
        return ResponseEntity.ok().build();
    }
}
```

#### üìù Checklist Tri·ªÉn Khai

**Backend (Spring Boot):**

- [ ] `@PreAuthorize` tr√™n m·ªçi controller methods
- [ ] Custom SpEL expressions cho complex permissions
- [ ] Method-level security enabled
- [ ] Business logic authorization trong service layer
- [ ] Audit logging cho admin functions

**Frontend (Angular):**

- [ ] Role-based routing guards
- [ ] Component-level permission checks
- [ ] Hide admin menus cho non-admin users
- [ ] Disable buttons d·ª±a tr√™n permissions

```typescript
// Angular Permission Service
@Injectable()
export class PermissionService {
  private userRole$ = this.authService.currentUser$.pipe(
    map((user) => user?.role)
  );

  canCreateProduct(): Observable<boolean> {
    return this.userRole$.pipe(
      map((role) => ["ADMIN", "SELLER"].includes(role))
    );
  }

  canDeleteProduct(productId: number): Observable<boolean> {
    return combineLatest([
      this.userRole$,
      this.productService.getProduct(productId),
    ]).pipe(
      map(
        ([role, product]) =>
          role === "ADMIN" ||
          (role === "SELLER" &&
            product.sellerId === this.authService.currentUserId)
      )
    );
  }
}
```

---

### API6:2023 - Unrestricted Access to Sensitive Business Flows

**üìä M·ª©c ƒê·ªô R·ªßi Ro**: üü† Trung B√¨nh-Cao  
**üéØ ·ª®ng D·ª•ng E-Commerce**: Bot ƒë·∫∑t h√†ng h√†ng lo·∫°t, spam reviews, scalping products

#### M√¥ T·∫£

APIs vulnerable cho risk n√†y expose business flow nh∆∞ buying ticket, posting comment m√† kh√¥ng compensate cho vi·ªác functionality c√≥ th·ªÉ harm business n·∫øu ƒë∆∞·ª£c s·ª≠ d·ª•ng excessively theo automated manner.

#### V√≠ D·ª• Trong D·ª± √Ån

```java
// ‚ùå KH√îNG AN TO√ÄN: Kh√¥ng protection cho sensitive business flows
@PostMapping("/api/orders")
public ResponseEntity<Order> createOrder(@RequestBody OrderRequest request) {
    Order order = orderService.create(request);
    return ResponseEntity.ok(order);
}

@PostMapping("/api/products/{id}/reviews")
public ResponseEntity<Review> addReview(
    @PathVariable Long id,
    @RequestBody ReviewRequest request
) {
    Review review = reviewService.create(id, request);
    return ResponseEntity.ok(review);
}

// ‚úÖ AN TO√ÄN: Protected sensitive business flows
@PostMapping("/api/orders")
@RateLimited(maxAttempts = 5, window = "1 hour") // Rate limiting
public ResponseEntity<Order> createOrder(
    @RequestBody @Valid OrderRequest request,
    Authentication auth,
    HttpServletRequest httpRequest
) {
    User user = userService.getCurrentUser(auth);

    // Business flow protection
    orderSecurityService.validateOrderCreation(user, request, httpRequest);

    Order order = orderService.create(request, user);

    // Log for monitoring
    auditService.logSensitiveOperation("ORDER_CREATE", user.getId(),
        Map.of("orderId", order.getId(), "totalAmount", order.getTotal()));

    return ResponseEntity.ok(order);
}

@PostMapping("/api/products/{id}/reviews")
@RateLimited(maxAttempts = 3, window = "1 day")
public ResponseEntity<Review> addReview(
    @PathVariable Long id,
    @RequestBody @Valid ReviewRequest request,
    Authentication auth
) {
    User user = userService.getCurrentUser(auth);

    // Ch·ªâ cho ph√©p review n·∫øu ƒë√£ mua s·∫£n ph·∫©m
    if (!orderService.hasUserPurchasedProduct(user.getId(), id)) {
        throw new ForbiddenException("Ch·ªâ c√≥ th·ªÉ review s·∫£n ph·∫©m ƒë√£ mua");
    }

    // Ch·ªâ cho ph√©p 1 review per product per user
    if (reviewService.hasUserReviewed(user.getId(), id)) {
        throw new ConflictException("B·∫°n ƒë√£ review s·∫£n ph·∫©m n√†y r·ªìi");
    }

    Review review = reviewService.create(id, request, user);
    return ResponseEntity.ok(review);
}
```

#### üìù Checklist Tri·ªÉn Khai

**Backend (Spring Boot):**

- [ ] Rate limiting cho sensitive endpoints
- [ ] Business rule validation (ƒë√£ mua m·ªõi ƒë∆∞·ª£c review)
- [ ] Monitoring v√† alerting cho unusual patterns
- [ ] CAPTCHA cho repeated actions
- [ ] Account verification requirements

**Frontend (Angular):**

- [ ] Progressive delays cho repeated actions
- [ ] User-friendly rate limit messaging
- [ ] Disable rapid clicking/submission
- [ ] Show confirmation cho sensitive actions

---

### API7:2023 - Server Side Request Forgery (SSRF)

**üìä M·ª©c ƒê·ªô R·ªßi Ro**: üü† Trung B√¨nh  
**üéØ ·ª®ng D·ª•ng E-Commerce**: Truy c·∫≠p internal services, scan internal network

#### M√¥ T·∫£

SSRF flaws c√≥ th·ªÉ occur khi API fetch remote resource m√† kh√¥ng validate user-supplied URI. Cho ph√©p attacker coerce application send crafted request ƒë·∫øn unexpected destination.

#### V√≠ D·ª• Trong D·ª± √Ån

````java
// ‚ùå KH√îNG AN TO√ÄN: User-controlled URL without validation
@PostMapping("/api/products/import-from-url")
public ResponseEntity<Product> importProductFromUrl(@RequestParam String url) {
    // Nguy hi·ªÉm! User c√≥ th·ªÉ truy c·∫≠p internal services
    String content = restTemplate.getForObject(url, String.class);
    Product product = productService.parseAndCreate(content);
    return ResponseEntity.ok(product);
}

// ‚úÖ AN TO√ÄN: URL validation v√† whitelist
@PostMapping("/api/products/import-from-url")
public ResponseEntity<Product> importProductFromUrl(@RequestParam String url) {
    // Validate URL format
    if (!isValidUrl(url)) {
        throw new InvalidRequestException("Invalid URL format");
    }

    // Whitelist allowed domains
    List<String> allowedDomains = Arrays.asList(
        "api.supplier1.com",
        "api.supplier2.com"
    );

    URI uri = URI.create(url);
    if (!allowedDomains.contains(uri.getHost())) {
        throw new ForbiddenException("Domain not allowed");
    }

    // Blacklist internal IPs
    if (isInternalIp(uri.getHost())) {
        throw new ForbiddenException("Internal IP access denied");
    }

    String content = restTemplate.getForObject(url, String.class);
    Product product = productService.parseAndCreate(content);
    return ResponseEntity.ok(product);
}

#### üìù Checklist Tri·ªÉn Khai

**Backend (Spring Boot):**
- [ ] URL validation v√† sanitization
- [ ] Domain whitelist cho external requests
- [ ] IP blacklist cho internal/private ranges
- [ ] Network segmentation
- [ ] Timeout v√† connection limits

**Frontend (Angular):**
- [ ] Validate URLs on client side (basic)
- [ ] No direct user input to external URLs
- [ ] Proper error handling cho failed requests

---

### API8:2023 - Security Misconfiguration

**üìä M·ª©c ƒê·ªô R·ªßi Ro**: üî¥ Cao
**üéØ ·ª®ng D·ª•ng E-Commerce**: L·ªô th√¥ng tin debug, CORS misconfiguration, weak TLS

#### M√¥ T·∫£
APIs v√† systems supporting them th∆∞·ªùng contain complex configurations ƒë·ªÉ make APIs more customizable. Engineers c√≥ th·ªÉ miss configurations ho·∫∑c don't follow security best practices.

#### V√≠ D·ª• Trong D·ª± √Ån

```yaml
# ‚ùå KH√îNG AN TO√ÄN: application.yml
spring:
  profiles:
    active: prod
  datasource:
    url: jdbc:mysql://localhost:3306/ecommerce
    username: root
    password: password123  # Hardcoded password!
  jpa:
    show-sql: true  # SQL logging trong production!
    hibernate:
      ddl-auto: create-drop  # M·∫•t data!

# Debug endpoints enabled
management:
  endpoints:
    web:
      exposure:
        include: "*"  # Expose t·∫•t c·∫£ endpoints!

# CORS cho ph√©p t·∫•t c·∫£
cors:
  allowed-origins: "*"
  allowed-methods: "*"
  allowed-headers: "*"

# ‚úÖ AN TO√ÄN: Secure configuration
spring:
  profiles:
    active: ${ENVIRONMENT:prod}
  datasource:
    url: ${DATABASE_URL}
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
  jpa:
    show-sql: false  # No SQL logging
    hibernate:
      ddl-auto: validate  # Safe for production

# Limited management endpoints
management:
  endpoints:
    web:
      exposure:
        include: health,info
      base-path: /actuator
  endpoint:
    health:
      show-details: when-authorized

# Restrictive CORS
cors:
  allowed-origins:
    - "https://yourdomain.com"
    - "https://www.yourdomain.com"
  allowed-methods: GET,POST,PUT,DELETE
  allowed-headers: Content-Type,Authorization
  allow-credentials: true
````

#### üìù Checklist Tri·ªÉn Khai

**Backend (Spring Boot):**

- [ ] Environment-based configuration
- [ ] Disable debug endpoints trong production
- [ ] Secure CORS configuration
- [ ] Proper error handling (no stack traces)
- [ ] Security headers implementation
- [ ] Database migration strategy (kh√¥ng d√πng ddl-auto)

**Frontend (Angular):**

- [ ] Environment-specific configs
- [ ] No console.log trong production build
- [ ] CSP headers configuration
- [ ] Secure cookie settings

**Infrastructure:**

- [ ] HTTPS everywhere v·ªõi proper certificates
- [ ] Security headers (HSTS, CSRF, XSS protection)
- [ ] Regular security updates
- [ ] Network firewall rules

---

### API9:2023 - Improper Inventory Management

**üìä M·ª©c ƒê·ªô R·ªßi Ro**: üü† Trung B√¨nh  
**üéØ ·ª®ng D·ª•ng E-Commerce**: Deprecated API versions, undocumented debug endpoints

#### M√¥ T·∫£

APIs tend to expose more endpoints than traditional web applications, making proper v√† updated documentation highly important. Proper inventory c·ªßa hosts v√† deployed API versions c≈©ng important ƒë·ªÉ mitigate issues.

#### V√≠ D·ª• Trong D·ª± √Ån

```java
// ‚ùå KH√îNG AN TO√ÄN: Multiple API versions without proper management
@RestController
@RequestMapping("/api/v1/products") // Old version
public class ProductControllerV1 {
    // Deprecated nh∆∞ng v·∫´n available
}

@RestController
@RequestMapping("/api/v2/products") // New version
public class ProductControllerV2 {
    // New features
}

@RestController
@RequestMapping("/debug/products") // Debug endpoint in production!
public class ProductDebugController {
    // Internal debugging tools
}

// ‚úÖ AN TO√ÄN: Proper API versioning v√† inventory
@RestController
@RequestMapping("/api/v2/products")
@ApiVersion("2.0")
public class ProductController {

    // Proper versioning strategy
}

// Deprecated API v·ªõi proper sunset
@RestController
@RequestMapping("/api/v1/products")
@Deprecated
@ApiVersion("1.0")
@ApiSunset("2024-12-31") // Clear sunset date
public class ProductControllerV1 {

    @GetMapping
    @Deprecated
    public ResponseEntity<List<Product>> getProducts() {
        // Add deprecation warning headers
        return ResponseEntity.ok()
            .header("Sunset", "Tue, 31 Dec 2024 23:59:59 GMT")
            .header("Deprecation", "true")
            .header("Link", "</api/v2/products>; rel=\"successor-version\"")
            .body(productService.findAllV1());
    }
}
```

#### üìù Checklist Tri·ªÉn Khai

**Backend (Spring Boot):**

- [ ] API versioning strategy documented
- [ ] Swagger/OpenAPI documentation up-to-date
- [ ] Deprecated APIs v·ªõi sunset dates
- [ ] No debug endpoints trong production
- [ ] API inventory documentation
- [ ] Regular security audits c·ªßa endpoints

**DevOps:**

- [ ] Automated API documentation generation
- [ ] Endpoint monitoring v√† alerting
- [ ] Regular penetration testing
- [ ] Version deprecation notifications

---

### API10:2023 - Unsafe Consumption of APIs

**üìä M·ª©c ƒê·ªô R·ªßi Ro**: üü† Trung B√¨nh  
**üéØ ·ª®ng D·ª•ng E-Commerce**: Compromised payment APIs, malicious supplier APIs

#### M√¥ T·∫£

Developers tend to trust data received t·ª´ third-party APIs more than user input, v√† adopt weaker security standards. Attackers go after integrated third-party services instead of trying to compromise target API directly.

#### V√≠ D·ª• Trong D·ª± √Ån

```java
// ‚ùå KH√îNG AN TO√ÄN: Unsafe consumption c·ªßa third-party APIs
@Service
public class PaymentService {

    public PaymentResult processPayment(PaymentRequest request) {
        // Kh√¥ng validate response t·ª´ payment gateway!
        PaymentResponse response = paymentGateway.process(request);

        // Trust response blindly
        if ("SUCCESS".equals(response.getStatus())) {
            orderService.markAsPaid(request.getOrderId());
        }

        return new PaymentResult(response.getStatus());
    }
}

// ‚úÖ AN TO√ÄN: Safe consumption v·ªõi validation
@Service
public class PaymentService {

    public PaymentResult processPayment(PaymentRequest request) {
        try {
            // Validate request tr∆∞·ªõc khi g·ª≠i
            validatePaymentRequest(request);

            PaymentResponse response = paymentGateway.process(request);

            // Validate response t·ª´ payment gateway
            validatePaymentResponse(response);

            // Double-check v·ªõi payment gateway (webhook ho·∫∑c query)
            PaymentStatus verifiedStatus = paymentGateway.verifyTransaction(response.getTransactionId());

            if (verifiedStatus.isSuccess() && verifiedStatus.getAmount().equals(request.getAmount())) {
                orderService.markAsPaid(request.getOrderId(), verifiedStatus);
                auditService.logPaymentSuccess(request.getOrderId(), verifiedStatus);
            } else {
                auditService.logPaymentMismatch(request.getOrderId(), response, verifiedStatus);
                throw new PaymentVerificationException("Payment verification failed");
            }

            return new PaymentResult(verifiedStatus.getStatus());

        } catch (Exception e) {
            auditService.logPaymentError(request.getOrderId(), e);
            throw new PaymentProcessingException("Payment processing failed", e);
        }
    }

    private void validatePaymentResponse(PaymentResponse response) {
        if (response == null) {
            throw new InvalidPaymentResponseException("Null response from payment gateway");
        }

        // Validate expected fields
        if (StringUtils.isBlank(response.getTransactionId()) ||
            StringUtils.isBlank(response.getStatus()) ||
            response.getAmount() == null) {
            throw new InvalidPaymentResponseException("Invalid payment response format");
        }

        // Validate status values
        if (!Arrays.asList("SUCCESS", "FAILED", "PENDING").contains(response.getStatus())) {
            throw new InvalidPaymentResponseException("Unknown payment status: " + response.getStatus());
        }
    }
}
```

#### üìù Checklist Tri·ªÉn Khai

**Backend (Spring Boot):**

- [ ] Validate t·∫•t c·∫£ input/output t·ª´ third-party APIs
- [ ] Implement circuit breakers cho external calls
- [ ] Use separate DTOs cho external API responses
- [ ] Webhook verification cho payment/shipping APIs
- [ ] Rate limiting cho outbound requests
- [ ] Comprehensive logging v√† monitoring

**Security:**

- [ ] API key/secret management
- [ ] Certificate pinning cho critical APIs
- [ ] Timeout configuration cho external calls
- [ ] Fallback mechanisms khi third-party APIs down

---

## üéØ CHECKLIST T·ªîNG TH·ªÇ - √ÅP D·ª§NG CHO D·ª∞ √ÅN ANGULAR + SPRING BOOT

### üîß Backend Security Checklist (Spring Boot)

#### Authentication & Authorization

- [ ] **JWT Implementation**: Strong secret, proper expiration, refresh tokens
- [ ] **Password Security**: BCrypt v·ªõi cost factor ‚â• 12
- [ ] **Role-Based Access Control**: @PreAuthorize tr√™n m·ªçi endpoints
- [ ] **Session Management**: Secure session configuration
- [ ] **Rate Limiting**: Implement cho login, sensitive endpoints

#### API Security

- [ ] **Input Validation**: @Valid annotations, custom validators
- [ ] **Output DTOs**: Separate DTOs cho t·ª´ng role, kh√¥ng expose entities
- [ ] **Pagination**: Max page size limits (‚â§ 100)
- [ ] **File Upload**: Size limits, type validation
- [ ] **CORS Configuration**: Restrictive origins, proper headers

#### Data Protection

- [ ] **Database Security**: Environment-based credentials, connection pooling
- [ ] **Sensitive Data**: Kh√¥ng log passwords, tokens, PII
- [ ] **Encryption**: Proper algorithms cho data at rest
- [ ] **Audit Logging**: Log m·ªçi sensitive operations

#### Configuration Security

- [ ] **Environment Variables**: All secrets in environment
- [ ] **Actuator Endpoints**: Disabled ho·∫∑c secured trong production
- [ ] **Error Handling**: Generic error messages, no stack traces
- [ ] **Dependencies**: Regular security updates

### üé® Frontend Security Checklist (Angular)

#### Authentication & Session

- [ ] **Token Storage**: HttpOnly cookies thay v√¨ localStorage
- [ ] **Auto Logout**: When token expires
- [ ] **Route Guards**: CanActivate cho protected routes
- [ ] **HTTP Interceptors**: Auto token injection, error handling

#### UI Security

- [ ] **Permission-Based UI**: Hide elements d·ª±a tr√™n roles
- [ ] **Form Validation**: Client-side validation + server validation
- [ ] **CSRF Protection**: Angular built-in CSRF protection
- [ ] **XSS Prevention**: Proper data binding, no innerHTML v·ªõi user data

#### Performance & UX

- [ ] **Rate Limiting UI**: Disable buttons sau submission
- [ ] **Loading States**: Show progress cho long operations
- [ ] **Error Handling**: User-friendly error messages
- [ ] **Offline Support**: Service worker cho basic caching

### üöÄ DevOps & Infrastructure Security

#### Network Security

- [ ] **HTTPS Everywhere**: Proper SSL/TLS certificates
- [ ] **Security Headers**: HSTS, CSP, X-Frame-Options
- [ ] **Firewall Rules**: Restrict unnecessary ports
- [ ] **Network Segmentation**: Separate database network

#### Monitoring & Logging

- [ ] **Security Monitoring**: Failed login attempts, unusual API usage
- [ ] **Error Logging**: Centralized logging system
- [ ] **Performance Monitoring**: API response times, resource usage
- [ ] **Alert System**: Notifications cho security incidents

#### Deployment Security

- [ ] **Container Security**: Secure base images, regular updates
- [ ] **Secrets Management**: Proper secret rotation
- [ ] **Database Backups**: Encrypted backups, tested restore
- [ ] **Disaster Recovery**: Clear recovery procedures

### üìä Priority Matrix cho D·ª± √Ån E-Commerce

#### üî¥ HIGH PRIORITY (Implement ngay)

1. **API1 - Broken Object Level Authorization**
   - Impact: Cao - Truy c·∫≠p ƒë∆°n h√†ng c·ªßa ng∆∞·ªùi kh√°c
   - Effort: Trung b√¨nh - Add ownership checks
2. **API2 - Broken Authentication**

   - Impact: Cao - Account takeover
   - Effort: Trung b√¨nh - JWT implementation

3. **API5 - Broken Function Level Authorization**
   - Impact: Cao - Admin function access
   - Effort: Th·∫•p - @PreAuthorize annotations

#### üü† MEDIUM PRIORITY (Implement trong sprint ti·∫øp)

4. **API3 - Broken Object Property Level Authorization**

   - Impact: Trung b√¨nh - Data exposure
   - Effort: Th·∫•p - DTO separation

5. **API8 - Security Misconfiguration**

   - Impact: Trung b√¨nh - Information disclosure
   - Effort: Th·∫•p - Configuration review

6. **API4 - Unrestricted Resource Consumption**
   - Impact: Trung b√¨nh - DoS attacks
   - Effort: Trung b√¨nh - Rate limiting

#### üü° LOW PRIORITY (Nice to have)

7. **API6 - Unrestricted Access to Sensitive Business Flows**

   - Impact: Th·∫•p - Business logic abuse
   - Effort: Cao - Complex business rules

8. **API7 - Server Side Request Forgery**

   - Impact: Th·∫•p - Internal network access
   - Effort: Th·∫•p - URL validation

9. **API9 - Improper Inventory Management**

   - Impact: Th·∫•p - Documentation issues
   - Effort: Trung b√¨nh - Documentation maintenance

10. **API10 - Unsafe Consumption of APIs**
    - Impact: Th·∫•p - Third-party compromises
    - Effort: Trung b√¨nh - Validation layer

### üîÑ Implementation Roadmap

#### Phase 1 (Sprint 1-2): Core Security

- [ ] Implement proper authentication (API2)
- [ ] Add authorization checks (API1, API5)
- [ ] Create separate DTOs (API3)
- [ ] Security configuration review (API8)

#### Phase 2 (Sprint 3-4): Performance & Monitoring

- [ ] Rate limiting implementation (API4)
- [ ] Audit logging system
- [ ] Security monitoring setup
- [ ] API documentation update (API9)

#### Phase 3 (Sprint 5-6): Advanced Security

- [ ] Business flow protection (API6)
- [ ] Third-party API security (API10)
- [ ] SSRF protection (API7)
- [ ] Comprehensive testing

### üìö T√†i Li·ªáu Tham Kh·∫£o

**OWASP Resources:**

- [OWASP API Security Top 10 - 2023](https://owasp.org/API-Security/editions/2023/en/0x11-t10/)
- [OWASP Web Application Security Testing Guide](https://owasp.org/www-project-web-security-testing-guide/)
- [OWASP Application Security Verification Standard](https://owasp.org/www-project-application-security-verification-standard/)

**Framework-Specific:**

- [Spring Security Documentation](https://spring.io/projects/spring-security)
- [Angular Security Guide](https://angular.io/guide/security)
- [JWT Best Practices](https://auth0.com/blog/a-look-at-the-latest-draft-for-jwt-bcp/)

---

## üèÅ K·∫øt Lu·∫≠n

Vi·ªác √°p d·ª•ng **OWASP API Security Top 10 - 2023** v√†o d·ª± √°n Angular + Spring Boot e-commerce ƒë√≤i h·ªèi approach c√≥ h·ªá th·ªëng v√† ∆∞u ti√™n r√µ r√†ng. **Broken Authorization** (API1, API5) v√† **Authentication issues** (API2) l√† c√°c r·ªßi ro cao nh·∫•t c·∫ßn ƒë∆∞·ª£c address ƒë·∫ßu ti√™n.

**Key Takeaways:**

1. **Authorization first**: Implement ownership checks v√† role-based access control
2. **Defense in depth**: Security ·ªü multiple layers (frontend, backend, infrastructure)
3. **Continuous monitoring**: Security kh√¥ng ph·∫£i one-time implementation
4. **Documentation**: Maintain updated API documentation v√† security procedures

**Recommendation**: B·∫Øt ƒë·∫ßu v·ªõi High Priority items v√† gradually implement medium/low priority items. Regular security reviews v√† penetration testing s·∫Ω help identify additional vulnerabilities.

---

**üìÖ Document Info:**

- **Version**: 1.0
- **Last Updated**: September 13, 2025
- **Authors**: CT07N0111 - M·∫°ch Ti·∫øn Duy, CT07N0162 - L√™ Thanh Y√™n
- **Project**: Angular + Spring Boot E-Commerce Security Implementation

```

// GOOD: Secure Design
public class SecurePasswordReset {
    // Lu√¥n tr·∫£ v·ªÅ success, c√≥ rate limiting
    @RateLimited(maxRequests = 3, timeWindow = "1h")
    public boolean resetPassword(String email) {
        if (userExists(email)) {
            sendResetEmail(email);
        }
        // Lu√¥n tr·∫£ v·ªÅ success ƒë·ªÉ kh√¥ng leak info
        return true;
    }
}
```

#### Bi·ªán Ph√°p Thi·∫øt K·∫ø An To√†n

- **Threat Modeling** t·ª´ giai ƒëo·∫°n thi·∫øt k·∫ø
- **Secure Design Patterns**: Fail-safe defaults, defense in depth
- **Security Stories** trong Agile development
- **Architecture Security Review**
- **Principle of Least Privilege** trong thi·∫øt k·∫ø

---

### A05:2021 - Security Misconfiguration

**M·ª©c ƒê·ªô Nghi√™m Tr·ªçng**: üü† Trung B√¨nh
**T·ª∑ L·ªá Ph√°t Hi·ªán**: 4.5% ·ª©ng d·ª•ng, >208k l·∫ßn xu·∫•t hi·ªán

#### C√°c L·ªói C·∫•u H√¨nh Ph·ªï Bi·∫øn

- **Default Credentials**: admin/admin, root/root
- **Unnecessary Features Enabled**: Debug mode, unused services
- **Missing Security Headers**: CSP, HSTS, X-Frame-Options
- **Verbose Error Messages**: Stack traces trong production
- **Outdated Security Configs**: TLS versions, cipher suites

#### E-Commerce Configuration Checklist

```yaml
# application.yml - BAD
spring:
  profiles:
    active: dev
  jpa:
    show-sql: true
    hibernate:
      ddl-auto: create-drop
server:
  error:
    include-stacktrace: always

# application.yml - GOOD
spring:
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:prod}
  jpa:
    show-sql: false
    hibernate:
      ddl-auto: validate
server:
  error:
    include-stacktrace: never
  ssl:
    enabled: true
security:
  headers:
    content-security-policy: "default-src 'self'"
```

---

### A06:2021 - Vulnerable and Outdated Components

**M·ª©c ƒê·ªô Nghi√™m Tr·ªçng**: üü† Trung B√¨nh - Cao
**ƒê·∫∑c ƒêi·ªÉm**: #2 trong kh·∫£o s√°t c·ªông ƒë·ªìng

#### V·∫•n ƒê·ªÅ Ch√≠nh

- **Outdated Libraries**: Log4j, Jackson, Spring versions c≈©
- **Unknown Dependencies**: Transitive dependencies
- **No Security Monitoring**: Kh√¥ng theo d√µi CVE m·ªõi
- **Slow Patching**: Ch·∫≠m c·∫≠p nh·∫≠t security patches

#### Dependency Management

```xml
<!-- pom.xml - S·ª≠ d·ª•ng dependency management -->
<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-dependencies</artifactId>
            <version>2.7.8</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>

<!-- S·ª≠ d·ª•ng OWASP Dependency Check -->
<plugin>
    <groupId>org.owasp</groupId>
    <artifactId>dependency-check-maven</artifactId>
    <version>8.1.0</version>
</plugin>
```

#### Bi·ªán Ph√°p Qu·∫£n L√Ω

- **Automated Vulnerability Scanning**: OWASP Dependency Check, Snyk
- **Regular Updates**: Monthly security patches
- **Software Composition Analysis (SCA)**
- **Remove Unused Dependencies**
- **CVE Monitoring**: Subscribe to security advisories

---

### A07:2021 - Identification and Authentication Failures

**M·ª©c ƒê·ªô Nghi√™m Tr·ªçng**: üü† Trung B√¨nh
**Tr∆∞·ªõc ƒê√¢y**: Broken Authentication

#### C√°c L·ªó H·ªïng Ch√≠nh

- **Weak Password Policies**: Cho ph√©p password y·∫øu
- **Credential Stuffing**: Kh√¥ng c√≥ protection ch·ªëng brute force
- **Session Management**: Session fixation, kh√¥ng expire
- **Missing MFA**: Kh√¥ng c√≥ x√°c th·ª±c 2 b∆∞·ªõc
- **Weak Recovery**: Password reset kh√¥ng an to√†n

#### Secure Authentication Implementation

```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder(12);
    }

    @Bean
    public AuthenticationFailureHandler failureHandler() {
        return new CustomFailureHandler(); // Rate limiting
    }

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .sessionManagement()
                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)
                .maximumSessions(1)
                .sessionRegistry(sessionRegistry())
            .and()
            .oauth2ResourceServer()
                .jwt()
            .and()
            .requiresChannel()
                .requestMatchers(r -> r.getHeader("X-Forwarded-Proto") != null)
                .requiresSecure();
    }
}
```

---

### A08:2021 - Software and Data Integrity Failures ‚≠ê M·ªöI

**M·ª©c ƒê·ªô Nghi√™m Tr·ªçng**: üî¥ Cao
**T·∫≠p Trung**: CI/CD pipeline v√† data integrity

#### C√°c R·ªßi Ro Ch√≠nh

- **Unsafe Deserialization**: Jackson, XML parsing
- **Insecure CI/CD**: Pipeline kh√¥ng ƒë∆∞·ª£c b·∫£o v·ªá
- **Auto-Update Without Verification**: C·∫≠p nh·∫≠t kh√¥ng verify signature
- **Supply Chain Attacks**: Compromised dependencies

#### Secure Deserialization

```java
// BAD: Unsafe deserialization
ObjectInputStream ois = new ObjectInputStream(input);
Object obj = ois.readObject(); // Nguy hi·ªÉm!

// GOOD: Safe JSON deserialization
@JsonTypeInfo(use = JsonTypeInfo.Id.NAME,
              include = JsonTypeInfo.As.PROPERTY)
@JsonSubTypes({
    @JsonSubTypes.Type(value = UserData.class, name = "user"),
    @JsonSubTypes.Type(value = OrderData.class, name = "order")
})
public abstract class SafeData {
    // Controlled polymorphism
}
```

#### CI/CD Security

```yaml
# .github/workflows/security.yml
name: Security Scan
on: [push, pull_request]

jobs:
  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: OWASP Dependency Check
        uses: dependency-check/Dependency-Check_Action@main
      - name: CodeQL Analysis
        uses: github/codeql-action/analyze@v2
      - name: Sign Artifacts
        run: gpg --detach-sign --armor target/*.jar
```

---

### A09:2021 - Security Logging and Monitoring Failures

**M·ª©c ƒê·ªô Nghi√™m Tr·ªçng**: üü° Trung B√¨nh
**·∫¢nh H∆∞·ªüng**: Incident response v√† forensics

#### C√°c Thi·∫øu S√≥t Th∆∞·ªùng G·∫∑p

- **Insufficient Logging**: Kh√¥ng log security events
- **No Monitoring**: Kh√¥ng c√≥ real-time monitoring
- **Poor Log Quality**: Log kh√¥ng c√≥ context ƒë·ªß
- **No Alerting**: Kh√¥ng c√≥ c·∫£nh b√°o t·ª± ƒë·ªông
- **Log Tampering**: Log c√≥ th·ªÉ b·ªã ch·ªânh s·ª≠a

#### Comprehensive Logging Strategy

```java
@Component
public class SecurityAuditLogger {

    private static final Logger securityLogger =
        LoggerFactory.getLogger("SECURITY");

    @EventListener
    public void handleAuthenticationSuccess(AuthenticationSuccessEvent event) {
        securityLogger.info("Authentication success: user={}, ip={}, timestamp={}",
            event.getAuthentication().getName(),
            getClientIP(),
            Instant.now());
    }

    @EventListener
    public void handleAuthenticationFailure(AbstractAuthenticationFailureEvent event) {
        securityLogger.warn("Authentication failure: user={}, ip={}, reason={}, timestamp={}",
            event.getAuthentication().getName(),
            getClientIP(),
            event.getException().getMessage(),
            Instant.now());
    }

    public void logPrivilegeEscalation(String user, String action, String resource) {
        securityLogger.error("PRIVILEGE_ESCALATION: user={}, action={}, resource={}, timestamp={}",
            user, action, resource, Instant.now());
    }
}
```

#### Essential Security Logs

- **Authentication Events**: Login/logout, failures
- **Authorization Failures**: Access denied events
- **Data Access**: Sensitive data queries
- **Configuration Changes**: Admin actions
- **Error Conditions**: Application errors

---

### A10:2021 - Server-Side Request Forgery (SSRF) ‚≠ê M·ªöI

**M·ª©c ƒê·ªô Nghi√™m Tr·ªçng**: üü† Trung B√¨nh - Cao
**ƒê·∫∑c ƒêi·ªÉm**: #1 trong kh·∫£o s√°t c·ªông ƒë·ªìng

#### M√¥ T·∫£

SSRF cho ph√©p attacker th·ª±c hi·ªán requests t·ª´ server ƒë·∫øn c√°c t√†i nguy√™n internal ho·∫∑c external kh√¥ng ƒë∆∞·ª£c ph√©p.

#### K·ªãch B·∫£n T·∫•n C√¥ng

```java
// BAD: Vulnerable to SSRF
@PostMapping("/api/fetch-url")
public String fetchUrl(@RequestParam String url) {
    RestTemplate restTemplate = new RestTemplate();
    return restTemplate.getForObject(url, String.class); // Nguy hi·ªÉm!
}

// GOOD: Protected against SSRF
@PostMapping("/api/fetch-url")
public String fetchUrl(@RequestParam String url) {
    if (!isAllowedUrl(url)) {
        throw new IllegalArgumentException("URL not allowed");
    }

    RestTemplate restTemplate = createSecureRestTemplate();
    return restTemplate.getForObject(url, String.class);
}

private boolean isAllowedUrl(String url) {
    try {
        URI uri = new URI(url);

        // Ch·ªâ cho ph√©p HTTPS
        if (!"https".equals(uri.getScheme())) {
            return false;
        }

        // Blacklist internal networks
        InetAddress addr = InetAddress.getByName(uri.getHost());
        return !addr.isLoopbackAddress() &&
               !addr.isLinkLocalAddress() &&
               !addr.isSiteLocalAddress();
    } catch (Exception e) {
        return false;
    }
}
```

#### Bi·ªán Ph√°p Ph√≤ng Ch·ªëng

- **URL Whitelist**: Ch·ªâ cho ph√©p trusted domains
- **Network Segmentation**: Isolate application servers
- **Disable Unused Protocols**: File://, gopher://, ftp://
- **Input Validation**: Validate v√† sanitize URLs
- **Response Validation**: Limit response size and content type

---

## üìä Ph∆∞∆°ng Ph√°p Lu·∫≠n & Thu Th·∫≠p D·ªØ Li·ªáu

### Data Sources

- **500,000+ applications** ƒë∆∞·ª£c ph√¢n t√≠ch
- **Contributors**: AppSec Labs, Cobalt.io, Contrast Security, GitLab, HackerOne, Veracode, WhiteHat (NTT)
- **~400 CWEs** ƒë∆∞·ª£c ph√¢n t√≠ch (tƒÉng t·ª´ ~30 CWEs)

### Methodology Changes

- **8 categories** t·ª´ contributed data
- **2 categories** t·ª´ community survey
- **Incidence Rate** thay v√¨ frequency ƒë·ªÉ tr√°nh bias
- **CVSSv3 Exploit v√† Impact scores** t·ª´ NVD

### Data Factors Explained

- **CWEs Mapped**: S·ªë l∆∞·ª£ng CWEs ƒë∆∞·ª£c map v√†o category
- **Incidence Rate**: % ·ª©ng d·ª•ng vulnerable
- **Testing Coverage**: % ·ª©ng d·ª•ng ƒë∆∞·ª£c test
- **Weighted Exploit**: ƒêi·ªÉm exploit t·ª´ CVSS (0-10)
- **Weighted Impact**: ƒêi·ªÉm impact t·ª´ CVSS (0-10)
- **Total Occurrences**: T·ªïng s·ªë ·ª©ng d·ª•ng c√≥ l·ªó h·ªïng
- **Total CVEs**: T·ªïng s·ªë CVEs mapped

---

## üõí ·ª®ng D·ª•ng V√†o H·ªá Th·ªëng Th∆∞∆°ng M·∫°i ƒêi·ªán T·ª≠

### Authentication & Authorization Matrix

| Role         | Permissions                            | OWASP Risks   |
| ------------ | -------------------------------------- | ------------- |
| **Guest**    | Xem s·∫£n ph·∫©m, th√™m gi·ªè h√†ng            | A01, A07      |
| **Customer** | Qu·∫£n l√Ω profile, ƒë·∫∑t h√†ng, xem l·ªãch s·ª≠ | A01, A02, A07 |
| **Seller**   | CRUD s·∫£n ph·∫©m, qu·∫£n l√Ω ƒë∆°n h√†ng        | A01, A04, A08 |
| **CS Agent** | Tra c·ª©u ƒë∆°n h√†ng, h·ªó tr·ª£ kh√°ch h√†ng    | A01, A09      |
| **Admin**    | Full access, c·∫•u h√¨nh h·ªá th·ªëng         | All risks     |

### E-Commerce Specific Mitigations

#### Payment Security

```java
@Service
public class PaymentService {

    // A02: Cryptographic Failures
    @Autowired
    private PaymentGateway secureGateway;

    public PaymentResult processPayment(PaymentRequest request) {
        // Kh√¥ng l∆∞u tr·ªØ PAN, ch·ªâ token
        String token = tokenizeCard(request.getCardNumber());

        // A08: Integrity verification
        if (!verifyPaymentIntegrity(request)) {
            throw new PaymentIntegrityException();
        }

        // A09: Audit logging
        auditLogger.logPaymentAttempt(request.getUserId(),
                                     request.getAmount(),
                                     request.getMerchantId());

        return secureGateway.processPayment(token, request.getAmount());
    }
}
```

#### Order Management Security

```java
@RestController
@RequestMapping("/api/orders")
public class OrderController {

    // A01: Broken Access Control
    @GetMapping("/{orderId}")
    @PreAuthorize("@orderService.isOwner(authentication.name, #orderId)")
    public OrderDTO getOrder(@PathVariable Long orderId) {
        return orderService.getOrderById(orderId);
    }

    // A03: Injection Prevention
    @GetMapping("/search")
    public List<OrderDTO> searchOrders(
            @RequestParam @Pattern(regexp="[a-zA-Z0-9\\s]+") String query,
            Authentication auth) {

        // A09: Security Logging
        securityLogger.info("Order search: user={}, query={}",
                           auth.getName(), query);

        return orderService.searchOrders(auth.getName(), query);
    }
}
```

### Data Privacy & GDPR Compliance

```java
@Entity
@Table(name = "customers")
public class Customer {

    // A02: Encrypt PII
    @Convert(converter = EncryptedStringConverter.class)
    @Column(name = "email")
    private String email;

    // A02: Hash sensitive data
    @Convert(converter = HashedStringConverter.class)
    @Column(name = "phone")
    private String phone;

    // A09: Audit trail
    @CreationTimestamp
    private LocalDateTime createdAt;

    @UpdateTimestamp
    private LocalDateTime updatedAt;

    @Column(name = "gdpr_consent")
    private boolean gdprConsent;

    @Column(name = "data_retention_date")
    private LocalDate dataRetentionDate;
}
```

---

## üéØ Khuy·∫øn Ngh·ªã Tri·ªÉn Khai

### Phase 1: Critical Security Foundations (0-3 th√°ng)

#### 1. Secure Authentication (A07)

- [ ] Implement JWT v·ªõi proper expiration
- [ ] Add rate limiting cho login attempts
- [ ] Enforce strong password policy
- [ ] Setup MFA cho admin accounts
- [ ] Implement secure password reset flow

#### 2. Access Control (A01)

- [ ] Implement RBAC v·ªõi clear role definitions
- [ ] Add ownership validation cho m·ªçi resources
- [ ] Setup API authorization v·ªõi proper scopes
- [ ] Implement session management
- [ ] Add CORS configuration

#### 3. Input Validation (A03)

- [ ] Parameterized queries cho t·∫•t c·∫£ database access
- [ ] Input sanitization v√† validation
- [ ] Output encoding cho XSS prevention
- [ ] WAF configuration
- [ ] CSP headers implementation

### Phase 2: Advanced Security Controls (3-6 th√°ng)

#### 4. Cryptographic Security (A02)

- [ ] Encrypt PII trong database
- [ ] Secure key management system
- [ ] HTTPS enforcement v·ªõi HSTS
- [ ] Proper session token generation
- [ ] Data masking cho logs

#### 5. Security Configuration (A05)

- [ ] Remove default credentials
- [ ] Disable unnecessary features
- [ ] Security headers implementation
- [ ] Environment-specific configurations
- [ ] Regular security audits

#### 6. Dependency Management (A06)

- [ ] OWASP Dependency Check integration
- [ ] Automated vulnerability scanning
- [ ] Regular dependency updates
- [ ] Software composition analysis
- [ ] CVE monitoring setup

### Phase 3: Comprehensive Security Program (6-12 th√°ng)

#### 7. Secure Design (A04)

- [ ] Threat modeling workshops
- [ ] Security design reviews
- [ ] Secure coding standards
- [ ] Architecture security assessment
- [ ] Security training program

#### 8. Integrity & Supply Chain (A08)

- [ ] Code signing implementation
- [ ] CI/CD pipeline security
- [ ] Artifact verification
- [ ] Supply chain risk assessment
- [ ] Secure update mechanisms

#### 9. Monitoring & Incident Response (A09)

- [ ] Comprehensive security logging
- [ ] Real-time monitoring setup
- [ ] SIEM integration
- [ ] Incident response procedures
- [ ] Forensics capabilities

#### 10. SSRF Protection (A10)

- [ ] URL validation v√† whitelist
- [ ] Network segmentation
- [ ] Internal service protection
- [ ] Response validation
- [ ] Protocol restrictions

### Implementation Checklist Per Technology Stack

#### Spring Boot Security

```java
// Security Configuration Template
@Configuration
@EnableWebSecurity
@EnableGlobalMethodSecurity(prePostEnabled = true)
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            // A01: Access Control
            .authorizeRequests()
                .antMatchers("/api/public/**").permitAll()
                .antMatchers("/api/admin/**").hasRole("ADMIN")
                .anyRequest().authenticated()
            .and()
            // A02: Session Security
            .sessionManagement()
                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)
            .and()
            // A05: Security Headers
            .headers()
                .frameOptions().deny()
                .contentTypeOptions().and()
                .httpStrictTransportSecurity(h -> h.maxAgeInSeconds(31536000))
            .and()
            // A03: CSRF Protection
            .csrf().csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse());
    }
}
```

#### Angular Security

```typescript
// HTTP Interceptor for Security
@Injectable()
export class SecurityInterceptor implements HttpInterceptor {
  intercept(
    req: HttpRequest<any>,
    next: HttpHandler
  ): Observable<HttpEvent<any>> {
    // A02: Add authentication token
    const authToken = this.authService.getToken();

    // A01: Validate request authorization
    if (!this.isAuthorizedRequest(req)) {
      throw new Error("Unauthorized request");
    }

    // A03: XSS Protection
    const sanitizedReq = this.sanitizeRequest(req);

    const authReq = sanitizedReq.clone({
      headers: sanitizedReq.headers.set("Authorization", `Bearer ${authToken}`),
    });

    return next.handle(authReq).pipe(
      // A09: Log security events
      tap((event) => this.logSecurityEvent(event)),
      catchError((error) => this.handleSecurityError(error))
    );
  }
}
```

---

## ‚ö†Ô∏è R·ªßi Ro & L∆∞u √ù

### Technical Debt Risks

- **Legacy Code**: Code c≈© c√≥ th·ªÉ ch·ª©a nhi·ªÅu vulnerabilities
- **Third-party Integrations**: Payment gateways, shipping APIs
- **Performance vs Security**: Balancing act c·∫ßn c·∫©n th·∫≠n
- **Complexity**: Over-engineering security c√≥ th·ªÉ g√¢y ph·∫£n t√°c d·ª•ng

### Legal & Compliance Considerations

- **PCI-DSS**: Payment card industry standards
- **GDPR**: Data protection v√† privacy
- **Local Regulations**: Lu·∫≠t b·∫£o v·ªá ng∆∞·ªùi ti√™u d√πng
- **Industry Standards**: E-commerce specific requirements

### Ongoing Security Maintenance

- **Regular Security Assessments**: Quarterly penetration testing
- **Vulnerability Management**: Monthly CVE reviews
- **Security Training**: Continuous developer education
- **Incident Response**: 24/7 monitoring v√† response capability

### Metrics & KPIs

- **Mean Time to Detect (MTTD)**: < 24 hours
- **Mean Time to Respond (MTTR)**: < 4 hours
- **Vulnerability Density**: < 1 per 1000 lines of code
- **Security Test Coverage**: > 80%
- **Patch Management**: Critical patches within 72 hours

---

## üìö Ph·ª• L·ª•c

### Glossary

- **CWE**: Common Weakness Enumeration
- **CVE**: Common Vulnerabilities and Exposures
- **CVSS**: Common Vulnerability Scoring System
- **SAST**: Static Application Security Testing
- **DAST**: Dynamic Application Security Testing
- **SCA**: Software Composition Analysis
- **WAF**: Web Application Firewall
- **SIEM**: Security Information and Event Management
