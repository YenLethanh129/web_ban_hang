# üë§ CT07N0111 - M·∫†CH TI·∫æN DUY - CT07N0162 - L√ä THANH Y√äN

# üîí Ph√¢n T√≠ch Chi Ti·∫øt OWASP Top 10 Web Application Security Risks 2021

## üìã T√≥m T·∫Øt

OWASP Top 10 l√† t√†i li·ªáu nh·∫≠n th·ª©c ti√™u chu·∫©n cho c√°c nh√† ph√°t tri·ªÉn v√† b·∫£o m·∫≠t ·ª©ng d·ª•ng web, th·ªÉ hi·ªán s·ª± ƒë·ªìng thu·∫≠n r·ªông r√£i v·ªÅ c√°c r·ªßi ro b·∫£o m·∫≠t quan tr·ªçng nh·∫•t ƒë·ªëi v·ªõi ·ª©ng d·ª•ng web. Phi√™n b·∫£n 2021 c√≥ thi·∫øt k·∫ø ƒë·ªì h·ªça m·ªõi ho√†n to√†n v√† d·ª±a tr√™n d·ªØ li·ªáu h∆°n bao gi·ªù h·∫øt, v·ªõi ba danh m·ª•c m·ªõi, b·ªën danh m·ª•c c√≥ thay ƒë·ªïi v·ªÅ t√™n v√† ph·∫°m vi.

### Nh·ªØng ƒêi·ªÉm N·ªïi B·∫≠t OWASP Top 10:2021

- **Ba danh m·ª•c ho√†n to√†n m·ªõi**: A04-Insecure Design, A08-Software and Data Integrity Failures, A10-Server-Side Request Forgery
- **A01-Broken Access Control**: T·ª´ v·ªã tr√≠ #5 l√™n #1 (94% ·ª©ng d·ª•ng ƒë∆∞·ª£c ki·ªÉm tra c√≥ l·ªó h·ªïng n√†y)
- **A10-SSRF**: Ho√†n to√†n m·ªõi, ƒë∆∞·ª£c c·ªông ƒë·ªìng b√¨nh ch·ªçn #1
 
## üõ°Ô∏è Ph√¢n T√≠ch Chi Ti·∫øt Top 10 Vulnerabilities

### A01:2021 - Broken Access Control

**M·ª©c ƒê·ªô Nghi√™m Tr·ªçng**: üî¥ C·ª±c Cao
**T·ª∑ L·ªá Ph√°t Hi·ªán**: 3.81% ·ª©ng d·ª•ng, >318k l·∫ßn xu·∫•t hi·ªán

#### M√¥ T·∫£

Ki·ªÉm so√°t truy c·∫≠p b·ªã h·ªèng cho ph√©p ng∆∞·ªùi d√πng h√†nh ƒë·ªông ngo√†i quy·ªÅn h·∫°n d·ª± ƒë·ªãnh c·ªßa h·ªç.

#### C√°c L·ªó H·ªïng Ph·ªï Bi·∫øn

- **Vertical Privilege Escalation**: User th∆∞·ªùng truy c·∫≠p ƒë∆∞·ª£c ch·ª©c nƒÉng admin
- **Horizontal Privilege Escalation**: User A xem/s·ª≠a ƒë∆∞·ª£c d·ªØ li·ªáu c·ªßa User B
- **CORS Misconfiguration**: C·∫•u h√¨nh CORS kh√¥ng an to√†n
- **Force Browsing**: Truy c·∫≠p tr·ª±c ti·∫øp URL m√† kh√¥ng c√≥ x√°c th·ª±c
- **API Exposure**: API kh√¥ng c√≥ ki·ªÉm so√°t truy c·∫≠p ph√π h·ª£p

#### V√≠ D·ª• Trong E-Commerce

```java
// BAD: Kh√¥ng ki·ªÉm tra quy·ªÅn s·ªü h·ªØu
@GetMapping("/api/orders/{orderId}")
public Order getOrder(@PathVariable Long orderId) {
    return orderService.findById(orderId); // Nguy hi·ªÉm!
}

// GOOD: Ki·ªÉm tra quy·ªÅn s·ªü h·ªØu
@GetMapping("/api/orders/{orderId}")
public Order getOrder(@PathVariable Long orderId, Authentication auth) {
    User currentUser = getCurrentUser(auth);
    Order order = orderService.findById(orderId);
    if (!order.getBelongsTo(currentUser)) {
        throw new AccessDeniedException("Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p");
    }
    return order;
}
```

#### Bi·ªán Ph√°p Ph√≤ng Ch·ªëng

- **Implement Role-Based Access Control (RBAC)**
- **Validate ownership** tr√™n m·ªçi resource
- **Deny by default**, ch·ªâ cho ph√©p nh·ªØng g√¨ ƒë∆∞·ª£c explicitly allowed
- **Log v√† monitor** m·ªçi access control failures
- **JWT v·ªõi scopes** r√µ r√†ng cho API

---

### A02:2021 - Cryptographic Failures

**M·ª©c ƒê·ªô Nghi√™m Tr·ªçng**: üî¥ Cao
**T·∫≠p Trung**: L·ªói m√£ h√≥a d·∫´n ƒë·∫øn l·ªô d·ªØ li·ªáu nh·∫°y c·∫£m

#### C√°c L·ªói Ph·ªï Bi·∫øn

- **Weak Encryption Algorithms**: MD5, SHA1, DES
- **Hard-coded Keys**: Secret key trong source code
- **Improper Key Management**: Key rotation, storage kh√¥ng an to√†n
- **Insufficient Randomness**: Predictable tokens/passwords
- **Missing Encryption**: D·ªØ li·ªáu nh·∫°y c·∫£m kh√¥ng ƒë∆∞·ª£c m√£ h√≥a

#### E-Commerce Specific Risks

```java
// BAD: Hard-coded key
private static final String SECRET_KEY = "mySecretKey123";

// BAD: Weak hashing for passwords
String hashedPassword = DigestUtils.md5Hex(plainPassword);

// GOOD: Proper password hashing
String hashedPassword = BCrypt.hashpw(plainPassword, BCrypt.gensalt(12));

// GOOD: Environment-based secrets
@Value("${app.jwt.secret}")
private String jwtSecret;
```

#### Bi·ªán Ph√°p B·∫£o V·ªá

- **Strong Algorithms**: AES-256, RSA-2048+, SHA-256+
- **Proper Key Management**: HSM, environment variables
- **Perfect Forward Secrecy** cho HTTPS
- **Salt + BCrypt** cho passwords
- **Encrypt PII** trong database v√† cache

---

### A03:2021 - Injection

**M·ª©c ƒê·ªô Nghi√™m Tr·ªçng**: üî¥ Cao
**T·ª∑ L·ªá Ph√°t Hi·ªán**: 3.37% ·ª©ng d·ª•ng, 274k l·∫ßn xu·∫•t hi·ªán

#### C√°c Lo·∫°i Injection

1. **SQL Injection**: Ch√®n SQL ƒë·ªôc h·∫°i
2. **NoSQL Injection**: MongoDB, Elasticsearch queries
3. **LDAP Injection**: Directory services
4. **OS Command Injection**: Th·ª±c thi l·ªánh h·ªá th·ªëng
5. **Cross-Site Scripting (XSS)**: Ch√®n JavaScript ƒë·ªôc h·∫°i

#### SQL Injection Example

```java
// BAD: Vulnerable to SQL Injection
String query = "SELECT * FROM users WHERE username='" + username + "'";

// GOOD: Parameterized Query
String query = "SELECT * FROM users WHERE username = ?";
PreparedStatement pstmt = connection.prepareStatement(query);
pstmt.setString(1, username);
```

#### XSS Prevention

```html
<!-- BAD: Raw output -->
<div>Xin ch√†o {{username}}</div>

<!-- GOOD: Escaped output -->
<div>Xin ch√†o {{username | escape}}</div>
```

#### Bi·ªán Ph√°p Ph√≤ng Ch·ªëng

- **Parameterized Queries/Prepared Statements**
- **Input Validation**: Whitelist approach
- **Output Encoding**: HTML, URL, JavaScript encoding
- **ORM Security**: Avoid raw queries
- **WAF Implementation**: Web Application Firewall

---

### A04:2021 - Insecure Design ‚≠ê M·ªöI

**M·ª©c ƒê·ªô Nghi√™m Tr·ªçng**: üü† Trung B√¨nh - Cao
**T·∫≠p Trung**: L·ªói thi·∫øt k·∫ø ki·∫øn tr√∫c

#### ƒê·∫∑c ƒêi·ªÉm

- **Kh√¥ng th·ªÉ s·ª≠a b·∫±ng implementation ho√†n h·∫£o**
- **Thi·∫øu threat modeling**
- **Kh√¥ng c√≥ security controls t·ª´ ƒë·∫ßu**
- **Missing security design patterns**

#### V√≠ D·ª• Insecure Design

```java
// BAD: Thi·∫øt k·∫ø kh√¥ng an to√†n
public class PasswordReset {
    // Reset b·∫±ng email duy nh·∫•t - d·ªÖ b·ªã brute force
    public boolean resetPassword(String email) {
        if (userExists(email)) {
            sendResetEmail(email);
            return true;
        }
        return false; // Ti·∫øt l·ªô user t·ªìn t·∫°i
    }
}

// GOOD: Secure Design
public class SecurePasswordReset {
    // Lu√¥n tr·∫£ v·ªÅ success, c√≥ rate limiting
    @RateLimited(maxRequests = 3, timeWindow = "1h")
    public boolean resetPassword(String email) {
        if (userExists(email)) {
            sendResetEmail(email);
        }
        // Lu√¥n tr·∫£ v·ªÅ success ƒë·ªÉ kh√¥ng leak info
        return true;
    }
}
```

#### Bi·ªán Ph√°p Thi·∫øt K·∫ø An To√†n

- **Threat Modeling** t·ª´ giai ƒëo·∫°n thi·∫øt k·∫ø
- **Secure Design Patterns**: Fail-safe defaults, defense in depth
- **Security Stories** trong Agile development
- **Architecture Security Review**
- **Principle of Least Privilege** trong thi·∫øt k·∫ø

---

### A05:2021 - Security Misconfiguration

**M·ª©c ƒê·ªô Nghi√™m Tr·ªçng**: üü† Trung B√¨nh
**T·ª∑ L·ªá Ph√°t Hi·ªán**: 4.5% ·ª©ng d·ª•ng, >208k l·∫ßn xu·∫•t hi·ªán

#### C√°c L·ªói C·∫•u H√¨nh Ph·ªï Bi·∫øn

- **Default Credentials**: admin/admin, root/root
- **Unnecessary Features Enabled**: Debug mode, unused services
- **Missing Security Headers**: CSP, HSTS, X-Frame-Options
- **Verbose Error Messages**: Stack traces trong production
- **Outdated Security Configs**: TLS versions, cipher suites

#### E-Commerce Configuration Checklist

```yaml
# application.yml - BAD
spring:
  profiles:
    active: dev
  jpa:
    show-sql: true
    hibernate:
      ddl-auto: create-drop
server:
  error:
    include-stacktrace: always

# application.yml - GOOD
spring:
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:prod}
  jpa:
    show-sql: false
    hibernate:
      ddl-auto: validate
server:
  error:
    include-stacktrace: never
  ssl:
    enabled: true
security:
  headers:
    content-security-policy: "default-src 'self'"
```

---

### A06:2021 - Vulnerable and Outdated Components

**M·ª©c ƒê·ªô Nghi√™m Tr·ªçng**: üü† Trung B√¨nh - Cao
**ƒê·∫∑c ƒêi·ªÉm**: #2 trong kh·∫£o s√°t c·ªông ƒë·ªìng

#### V·∫•n ƒê·ªÅ Ch√≠nh

- **Outdated Libraries**: Log4j, Jackson, Spring versions c≈©
- **Unknown Dependencies**: Transitive dependencies
- **No Security Monitoring**: Kh√¥ng theo d√µi CVE m·ªõi
- **Slow Patching**: Ch·∫≠m c·∫≠p nh·∫≠t security patches

#### Dependency Management

```xml
<!-- pom.xml - S·ª≠ d·ª•ng dependency management -->
<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-dependencies</artifactId>
            <version>2.7.8</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>

<!-- S·ª≠ d·ª•ng OWASP Dependency Check -->
<plugin>
    <groupId>org.owasp</groupId>
    <artifactId>dependency-check-maven</artifactId>
    <version>8.1.0</version>
</plugin>
```

#### Bi·ªán Ph√°p Qu·∫£n L√Ω

- **Automated Vulnerability Scanning**: OWASP Dependency Check, Snyk
- **Regular Updates**: Monthly security patches
- **Software Composition Analysis (SCA)**
- **Remove Unused Dependencies**
- **CVE Monitoring**: Subscribe to security advisories

---

### A07:2021 - Identification and Authentication Failures

**M·ª©c ƒê·ªô Nghi√™m Tr·ªçng**: üü† Trung B√¨nh
**Tr∆∞·ªõc ƒê√¢y**: Broken Authentication

#### C√°c L·ªó H·ªïng Ch√≠nh

- **Weak Password Policies**: Cho ph√©p password y·∫øu
- **Credential Stuffing**: Kh√¥ng c√≥ protection ch·ªëng brute force
- **Session Management**: Session fixation, kh√¥ng expire
- **Missing MFA**: Kh√¥ng c√≥ x√°c th·ª±c 2 b∆∞·ªõc
- **Weak Recovery**: Password reset kh√¥ng an to√†n

#### Secure Authentication Implementation

```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder(12);
    }

    @Bean
    public AuthenticationFailureHandler failureHandler() {
        return new CustomFailureHandler(); // Rate limiting
    }

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .sessionManagement()
                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)
                .maximumSessions(1)
                .sessionRegistry(sessionRegistry())
            .and()
            .oauth2ResourceServer()
                .jwt()
            .and()
            .requiresChannel()
                .requestMatchers(r -> r.getHeader("X-Forwarded-Proto") != null)
                .requiresSecure();
    }
}
```

---

### A08:2021 - Software and Data Integrity Failures ‚≠ê M·ªöI

**M·ª©c ƒê·ªô Nghi√™m Tr·ªçng**: üî¥ Cao
**T·∫≠p Trung**: CI/CD pipeline v√† data integrity

#### C√°c R·ªßi Ro Ch√≠nh

- **Unsafe Deserialization**: Jackson, XML parsing
- **Insecure CI/CD**: Pipeline kh√¥ng ƒë∆∞·ª£c b·∫£o v·ªá
- **Auto-Update Without Verification**: C·∫≠p nh·∫≠t kh√¥ng verify signature
- **Supply Chain Attacks**: Compromised dependencies

#### Secure Deserialization

```java
// BAD: Unsafe deserialization
ObjectInputStream ois = new ObjectInputStream(input);
Object obj = ois.readObject(); // Nguy hi·ªÉm!

// GOOD: Safe JSON deserialization
@JsonTypeInfo(use = JsonTypeInfo.Id.NAME,
              include = JsonTypeInfo.As.PROPERTY)
@JsonSubTypes({
    @JsonSubTypes.Type(value = UserData.class, name = "user"),
    @JsonSubTypes.Type(value = OrderData.class, name = "order")
})
public abstract class SafeData {
    // Controlled polymorphism
}
```

#### CI/CD Security

```yaml
# .github/workflows/security.yml
name: Security Scan
on: [push, pull_request]

jobs:
  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: OWASP Dependency Check
        uses: dependency-check/Dependency-Check_Action@main
      - name: CodeQL Analysis
        uses: github/codeql-action/analyze@v2
      - name: Sign Artifacts
        run: gpg --detach-sign --armor target/*.jar
```

---

### A09:2021 - Security Logging and Monitoring Failures

**M·ª©c ƒê·ªô Nghi√™m Tr·ªçng**: üü° Trung B√¨nh
**·∫¢nh H∆∞·ªüng**: Incident response v√† forensics

#### C√°c Thi·∫øu S√≥t Th∆∞·ªùng G·∫∑p

- **Insufficient Logging**: Kh√¥ng log security events
- **No Monitoring**: Kh√¥ng c√≥ real-time monitoring
- **Poor Log Quality**: Log kh√¥ng c√≥ context ƒë·ªß
- **No Alerting**: Kh√¥ng c√≥ c·∫£nh b√°o t·ª± ƒë·ªông
- **Log Tampering**: Log c√≥ th·ªÉ b·ªã ch·ªânh s·ª≠a

#### Comprehensive Logging Strategy

```java
@Component
public class SecurityAuditLogger {

    private static final Logger securityLogger =
        LoggerFactory.getLogger("SECURITY");

    @EventListener
    public void handleAuthenticationSuccess(AuthenticationSuccessEvent event) {
        securityLogger.info("Authentication success: user={}, ip={}, timestamp={}",
            event.getAuthentication().getName(),
            getClientIP(),
            Instant.now());
    }

    @EventListener
    public void handleAuthenticationFailure(AbstractAuthenticationFailureEvent event) {
        securityLogger.warn("Authentication failure: user={}, ip={}, reason={}, timestamp={}",
            event.getAuthentication().getName(),
            getClientIP(),
            event.getException().getMessage(),
            Instant.now());
    }

    public void logPrivilegeEscalation(String user, String action, String resource) {
        securityLogger.error("PRIVILEGE_ESCALATION: user={}, action={}, resource={}, timestamp={}",
            user, action, resource, Instant.now());
    }
}
```

#### Essential Security Logs

- **Authentication Events**: Login/logout, failures
- **Authorization Failures**: Access denied events
- **Data Access**: Sensitive data queries
- **Configuration Changes**: Admin actions
- **Error Conditions**: Application errors

---

### A10:2021 - Server-Side Request Forgery (SSRF) ‚≠ê M·ªöI

**M·ª©c ƒê·ªô Nghi√™m Tr·ªçng**: üü† Trung B√¨nh - Cao
**ƒê·∫∑c ƒêi·ªÉm**: #1 trong kh·∫£o s√°t c·ªông ƒë·ªìng

#### M√¥ T·∫£

SSRF cho ph√©p attacker th·ª±c hi·ªán requests t·ª´ server ƒë·∫øn c√°c t√†i nguy√™n internal ho·∫∑c external kh√¥ng ƒë∆∞·ª£c ph√©p.

#### K·ªãch B·∫£n T·∫•n C√¥ng

```java
// BAD: Vulnerable to SSRF
@PostMapping("/api/fetch-url")
public String fetchUrl(@RequestParam String url) {
    RestTemplate restTemplate = new RestTemplate();
    return restTemplate.getForObject(url, String.class); // Nguy hi·ªÉm!
}

// GOOD: Protected against SSRF
@PostMapping("/api/fetch-url")
public String fetchUrl(@RequestParam String url) {
    if (!isAllowedUrl(url)) {
        throw new IllegalArgumentException("URL not allowed");
    }

    RestTemplate restTemplate = createSecureRestTemplate();
    return restTemplate.getForObject(url, String.class);
}

private boolean isAllowedUrl(String url) {
    try {
        URI uri = new URI(url);

        // Ch·ªâ cho ph√©p HTTPS
        if (!"https".equals(uri.getScheme())) {
            return false;
        }

        // Blacklist internal networks
        InetAddress addr = InetAddress.getByName(uri.getHost());
        return !addr.isLoopbackAddress() &&
               !addr.isLinkLocalAddress() &&
               !addr.isSiteLocalAddress();
    } catch (Exception e) {
        return false;
    }
}
```

#### Bi·ªán Ph√°p Ph√≤ng Ch·ªëng

- **URL Whitelist**: Ch·ªâ cho ph√©p trusted domains
- **Network Segmentation**: Isolate application servers
- **Disable Unused Protocols**: File://, gopher://, ftp://
- **Input Validation**: Validate v√† sanitize URLs
- **Response Validation**: Limit response size and content type

---

## üìä Ph∆∞∆°ng Ph√°p Lu·∫≠n & Thu Th·∫≠p D·ªØ Li·ªáu

### Data Sources

- **500,000+ applications** ƒë∆∞·ª£c ph√¢n t√≠ch
- **Contributors**: AppSec Labs, Cobalt.io, Contrast Security, GitLab, HackerOne, Veracode, WhiteHat (NTT)
- **~400 CWEs** ƒë∆∞·ª£c ph√¢n t√≠ch (tƒÉng t·ª´ ~30 CWEs)

### Methodology Changes

- **8 categories** t·ª´ contributed data
- **2 categories** t·ª´ community survey
- **Incidence Rate** thay v√¨ frequency ƒë·ªÉ tr√°nh bias
- **CVSSv3 Exploit v√† Impact scores** t·ª´ NVD

### Data Factors Explained

- **CWEs Mapped**: S·ªë l∆∞·ª£ng CWEs ƒë∆∞·ª£c map v√†o category
- **Incidence Rate**: % ·ª©ng d·ª•ng vulnerable
- **Testing Coverage**: % ·ª©ng d·ª•ng ƒë∆∞·ª£c test
- **Weighted Exploit**: ƒêi·ªÉm exploit t·ª´ CVSS (0-10)
- **Weighted Impact**: ƒêi·ªÉm impact t·ª´ CVSS (0-10)
- **Total Occurrences**: T·ªïng s·ªë ·ª©ng d·ª•ng c√≥ l·ªó h·ªïng
- **Total CVEs**: T·ªïng s·ªë CVEs mapped

---

## üõí ·ª®ng D·ª•ng V√†o H·ªá Th·ªëng Th∆∞∆°ng M·∫°i ƒêi·ªán T·ª≠

### Authentication & Authorization Matrix

| Role         | Permissions                            | OWASP Risks   |
| ------------ | -------------------------------------- | ------------- |
| **Guest**    | Xem s·∫£n ph·∫©m, th√™m gi·ªè h√†ng            | A01, A07      |
| **Customer** | Qu·∫£n l√Ω profile, ƒë·∫∑t h√†ng, xem l·ªãch s·ª≠ | A01, A02, A07 |
| **Seller**   | CRUD s·∫£n ph·∫©m, qu·∫£n l√Ω ƒë∆°n h√†ng        | A01, A04, A08 |
| **CS Agent** | Tra c·ª©u ƒë∆°n h√†ng, h·ªó tr·ª£ kh√°ch h√†ng    | A01, A09      |
| **Admin**    | Full access, c·∫•u h√¨nh h·ªá th·ªëng         | All risks     |

### E-Commerce Specific Mitigations

#### Payment Security

```java
@Service
public class PaymentService {

    // A02: Cryptographic Failures
    @Autowired
    private PaymentGateway secureGateway;

    public PaymentResult processPayment(PaymentRequest request) {
        // Kh√¥ng l∆∞u tr·ªØ PAN, ch·ªâ token
        String token = tokenizeCard(request.getCardNumber());

        // A08: Integrity verification
        if (!verifyPaymentIntegrity(request)) {
            throw new PaymentIntegrityException();
        }

        // A09: Audit logging
        auditLogger.logPaymentAttempt(request.getUserId(),
                                     request.getAmount(),
                                     request.getMerchantId());

        return secureGateway.processPayment(token, request.getAmount());
    }
}
```

#### Order Management Security

```java
@RestController
@RequestMapping("/api/orders")
public class OrderController {

    // A01: Broken Access Control
    @GetMapping("/{orderId}")
    @PreAuthorize("@orderService.isOwner(authentication.name, #orderId)")
    public OrderDTO getOrder(@PathVariable Long orderId) {
        return orderService.getOrderById(orderId);
    }

    // A03: Injection Prevention
    @GetMapping("/search")
    public List<OrderDTO> searchOrders(
            @RequestParam @Pattern(regexp="[a-zA-Z0-9\\s]+") String query,
            Authentication auth) {

        // A09: Security Logging
        securityLogger.info("Order search: user={}, query={}",
                           auth.getName(), query);

        return orderService.searchOrders(auth.getName(), query);
    }
}
```

### Data Privacy & GDPR Compliance

```java
@Entity
@Table(name = "customers")
public class Customer {

    // A02: Encrypt PII
    @Convert(converter = EncryptedStringConverter.class)
    @Column(name = "email")
    private String email;

    // A02: Hash sensitive data
    @Convert(converter = HashedStringConverter.class)
    @Column(name = "phone")
    private String phone;

    // A09: Audit trail
    @CreationTimestamp
    private LocalDateTime createdAt;

    @UpdateTimestamp
    private LocalDateTime updatedAt;

    @Column(name = "gdpr_consent")
    private boolean gdprConsent;

    @Column(name = "data_retention_date")
    private LocalDate dataRetentionDate;
}
```

---

## üéØ Khuy·∫øn Ngh·ªã Tri·ªÉn Khai

### Phase 1: Critical Security Foundations (0-3 th√°ng)

#### 1. Secure Authentication (A07)

- [ ] Implement JWT v·ªõi proper expiration
- [ ] Add rate limiting cho login attempts
- [ ] Enforce strong password policy
- [ ] Setup MFA cho admin accounts
- [ ] Implement secure password reset flow

#### 2. Access Control (A01)

- [ ] Implement RBAC v·ªõi clear role definitions
- [ ] Add ownership validation cho m·ªçi resources
- [ ] Setup API authorization v·ªõi proper scopes
- [ ] Implement session management
- [ ] Add CORS configuration

#### 3. Input Validation (A03)

- [ ] Parameterized queries cho t·∫•t c·∫£ database access
- [ ] Input sanitization v√† validation
- [ ] Output encoding cho XSS prevention
- [ ] WAF configuration
- [ ] CSP headers implementation

### Phase 2: Advanced Security Controls (3-6 th√°ng)

#### 4. Cryptographic Security (A02)

- [ ] Encrypt PII trong database
- [ ] Secure key management system
- [ ] HTTPS enforcement v·ªõi HSTS
- [ ] Proper session token generation
- [ ] Data masking cho logs

#### 5. Security Configuration (A05)

- [ ] Remove default credentials
- [ ] Disable unnecessary features
- [ ] Security headers implementation
- [ ] Environment-specific configurations
- [ ] Regular security audits

#### 6. Dependency Management (A06)

- [ ] OWASP Dependency Check integration
- [ ] Automated vulnerability scanning
- [ ] Regular dependency updates
- [ ] Software composition analysis
- [ ] CVE monitoring setup

### Phase 3: Comprehensive Security Program (6-12 th√°ng)

#### 7. Secure Design (A04)

- [ ] Threat modeling workshops
- [ ] Security design reviews
- [ ] Secure coding standards
- [ ] Architecture security assessment
- [ ] Security training program

#### 8. Integrity & Supply Chain (A08)

- [ ] Code signing implementation
- [ ] CI/CD pipeline security
- [ ] Artifact verification
- [ ] Supply chain risk assessment
- [ ] Secure update mechanisms

#### 9. Monitoring & Incident Response (A09)

- [ ] Comprehensive security logging
- [ ] Real-time monitoring setup
- [ ] SIEM integration
- [ ] Incident response procedures
- [ ] Forensics capabilities

#### 10. SSRF Protection (A10)

- [ ] URL validation v√† whitelist
- [ ] Network segmentation
- [ ] Internal service protection
- [ ] Response validation
- [ ] Protocol restrictions

### Implementation Checklist Per Technology Stack

#### Spring Boot Security

```java
// Security Configuration Template
@Configuration
@EnableWebSecurity
@EnableGlobalMethodSecurity(prePostEnabled = true)
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            // A01: Access Control
            .authorizeRequests()
                .antMatchers("/api/public/**").permitAll()
                .antMatchers("/api/admin/**").hasRole("ADMIN")
                .anyRequest().authenticated()
            .and()
            // A02: Session Security
            .sessionManagement()
                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)
            .and()
            // A05: Security Headers
            .headers()
                .frameOptions().deny()
                .contentTypeOptions().and()
                .httpStrictTransportSecurity(h -> h.maxAgeInSeconds(31536000))
            .and()
            // A03: CSRF Protection
            .csrf().csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse());
    }
}
```

#### Angular Security

```typescript
// HTTP Interceptor for Security
@Injectable()
export class SecurityInterceptor implements HttpInterceptor {
  intercept(
    req: HttpRequest<any>,
    next: HttpHandler
  ): Observable<HttpEvent<any>> {
    // A02: Add authentication token
    const authToken = this.authService.getToken();

    // A01: Validate request authorization
    if (!this.isAuthorizedRequest(req)) {
      throw new Error("Unauthorized request");
    }

    // A03: XSS Protection
    const sanitizedReq = this.sanitizeRequest(req);

    const authReq = sanitizedReq.clone({
      headers: sanitizedReq.headers.set("Authorization", `Bearer ${authToken}`),
    });

    return next.handle(authReq).pipe(
      // A09: Log security events
      tap((event) => this.logSecurityEvent(event)),
      catchError((error) => this.handleSecurityError(error))
    );
  }
}
```

---

## ‚ö†Ô∏è R·ªßi Ro & L∆∞u √ù

### Technical Debt Risks

- **Legacy Code**: Code c≈© c√≥ th·ªÉ ch·ª©a nhi·ªÅu vulnerabilities
- **Third-party Integrations**: Payment gateways, shipping APIs
- **Performance vs Security**: Balancing act c·∫ßn c·∫©n th·∫≠n
- **Complexity**: Over-engineering security c√≥ th·ªÉ g√¢y ph·∫£n t√°c d·ª•ng

### Legal & Compliance Considerations

- **PCI-DSS**: Payment card industry standards
- **GDPR**: Data protection v√† privacy
- **Local Regulations**: Lu·∫≠t b·∫£o v·ªá ng∆∞·ªùi ti√™u d√πng
- **Industry Standards**: E-commerce specific requirements

### Ongoing Security Maintenance

- **Regular Security Assessments**: Quarterly penetration testing
- **Vulnerability Management**: Monthly CVE reviews
- **Security Training**: Continuous developer education
- **Incident Response**: 24/7 monitoring v√† response capability

### Metrics & KPIs

- **Mean Time to Detect (MTTD)**: < 24 hours
- **Mean Time to Respond (MTTR)**: < 4 hours
- **Vulnerability Density**: < 1 per 1000 lines of code
- **Security Test Coverage**: > 80%
- **Patch Management**: Critical patches within 72 hours

---

## üìö Ph·ª• L·ª•c

### Glossary

- **CWE**: Common Weakness Enumeration
- **CVE**: Common Vulnerabilities and Exposures
- **CVSS**: Common Vulnerability Scoring System
- **SAST**: Static Application Security Testing
- **DAST**: Dynamic Application Security Testing
- **SCA**: Software Composition Analysis
- **WAF**: Web Application Firewall
- **SIEM**: Security Information and Event Management
