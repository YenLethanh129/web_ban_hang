<div class="register-page">
  <div class="register-container">
    <div class="register-form-wrapper">
      <div class="register-header">
        <div class="brand-section">
          <h1 class="brand-title">FUNNY BOY</h1>
          <p class="brand-subtitle">Coffee & Tea</p>
        </div>
        <h2 class="register-title">Tạo tài khoản mới</h2>
        <p class="register-subtitle">
          Tham gia cộng đồng yêu thích trà & cà phê
        </p>

        <!-- Auto-fill button -->
        <div *ngIf="showAutofillButton" class="autofill-section">
          <button
            type="button"
            class="btn btn-outline-primary autofill-btn"
            (click)="autofillFromProfile()"
          >
            <i class="fas fa-magic"></i>
            Tự động điền từ hồ sơ
          </button>
          <p class="autofill-note">Điền thông tin từ tài khoản đã đăng nhập</p>
        </div>
      </div>

      <form
        (ngSubmit)="onSubmit()"
        #registerForm="ngForm"
        class="register-form"
      >
        <div class="form-group">
          <label for="fullName" class="form-label">
            <i class="fas fa-user"></i>
            Họ và tên
          </label>
          <div class="input-wrapper">
            <input
              type="text"
              class="form-control"
              id="fullName"
              name="fullName"
              [(ngModel)]="registerData.fullName"
              required
              #fullName="ngModel"
              (focus)="showFullNameError = true"
              placeholder="Nhập họ và tên đầy đủ"
            />
            <i class="fas fa-user input-icon"></i>
          </div>
          <div
            *ngIf="
              showFullNameError && fullName.touched && !registerData.fullName
            "
            class="error-message"
          >
            <i class="fas fa-exclamation-circle"></i>
            Vui lòng nhập họ và tên
          </div>
        </div>

        <div class="form-group">
          <label for="phoneNumber" class="form-label">
            <i class="fas fa-phone"></i>
            Số điện thoại
          </label>
          <div class="input-wrapper">
            <input
              type="tel"
              class="form-control"
              id="phoneNumber"
              name="phoneNumber"
              (input)="validatePhoneNumber($event)"
              [(ngModel)]="registerData.phoneNumber"
              required
              #phone="ngModel"
              (focus)="showPhoneError = true"
              placeholder="Nhập số điện thoại (10 số)"
            />
            <i class="fas fa-phone input-icon"></i>
          </div>
          <div
            *ngIf="
              showPhoneError &&
              phone.touched &&
              registerData.phoneNumber.length !== 10
            "
            class="error-message"
          >
            <i class="fas fa-exclamation-circle"></i>
            Số điện thoại phải là 10 số
          </div>
        </div>

        <div class="form-group">
          <label for="dateOfBirth" class="form-label">
            <i class="fas fa-calendar-alt"></i>
            Ngày sinh
          </label>
          <div class="input-wrapper">
            <input
              type="date"
              class="form-control"
              id="dateOfBirth"
              name="dateOfBirth"
              [(ngModel)]="registerData.dateOfBirth"
              required
              #dateOfBirth="ngModel"
              (focus)="showDateOfBirthError = true"
            />
            <i class="fas fa-calendar-alt input-icon"></i>
          </div>
          <div
            *ngIf="
              showDateOfBirthError &&
              dateOfBirth.touched &&
              (!registerData.dateOfBirth || !validateAge())
            "
            class="error-message"
          >
            <i class="fas fa-exclamation-circle"></i>
            {{
              !registerData.dateOfBirth
                ? "Vui lòng chọn ngày sinh"
                : "Bạn phải trên 18 tuổi"
            }}
          </div>
        </div>

        <div class="form-group">
          <app-address-autocomplete
            [(ngModel)]="registerData.address"
            name="address"
            #address="ngModel"
            [required]="true"
            [useCurrentLocation]="true"
            placeholder="Nhập địa chỉ đầy đủ của bạn"
            label="Địa chỉ"
            (addressSelected)="onAddressSelected($event)"
            (inputFocus)="onAddressFocus()"
          ></app-address-autocomplete>
          <div
            *ngIf="showAddressError && address.touched && !registerData.address"
            class="error-message"
          >
            <i class="fas fa-exclamation-circle"></i>
            Vui lòng nhập địa chỉ
          </div>
        </div>

        <div class="form-group">
          <label for="password" class="form-label">
            <i class="fas fa-lock"></i>
            Mật khẩu
          </label>
          <div class="input-wrapper password-wrapper">
            <input
              [type]="showPassword ? 'text' : 'password'"
              class="form-control"
              id="password"
              name="password"
              [(ngModel)]="registerData.password"
              required
              #password="ngModel"
              (focus)="showPasswordError = true"
              placeholder="Nhập mật khẩu (ít nhất 6 ký tự)"
            />
            <i class="fas fa-lock input-icon"></i>
            <i
              class="fa-solid password-toggle"
              [class.fa-eye]="!showPassword"
              [class.fa-eye-slash]="showPassword"
              (click)="togglePasswordVisibility('password')"
            ></i>
          </div>
          <div
            *ngIf="showPasswordError && password.touched && !validatePassword()"
            class="error-message"
          >
            <i class="fas fa-exclamation-circle"></i>
            Mật khẩu phải có ít nhất 6 ký tự
          </div>
        </div>

        <div class="form-group">
          <label for="confirmPassword" class="form-label">
            <i class="fas fa-lock"></i>
            Xác nhận mật khẩu
          </label>
          <div class="input-wrapper password-wrapper">
            <input
              [type]="showConfirmPassword ? 'text' : 'password'"
              class="form-control"
              id="confirmPassword"
              name="confirmPassword"
              [(ngModel)]="registerData.confirmPassword"
              required
              #confirmPassword="ngModel"
              (focus)="showConfirmPasswordError = true"
              placeholder="Nhập lại mật khẩu để xác nhận"
            />
            <i class="fas fa-lock input-icon"></i>
            <i
              class="fa-solid password-toggle"
              [class.fa-eye]="!showConfirmPassword"
              [class.fa-eye-slash]="showConfirmPassword"
              (click)="togglePasswordVisibility('confirmPassword')"
            ></i>
          </div>
          <div
            *ngIf="
              showConfirmPasswordError &&
              confirmPassword.touched &&
              !validateConfirmPassword()
            "
            class="error-message"
          >
            <i class="fas fa-exclamation-circle"></i>
            Mật khẩu xác nhận không khớp
          </div>
        </div>

        <div class="terms-agreement">
          <div class="terms-check">
            <input
              type="checkbox"
              class="form-check-input"
              id="agreeTerms"
              name="agreeTerms"
              [(ngModel)]="agreeToTerms"
              required
            />
            <label class="form-check-label" for="agreeTerms">
              <span class="checkmark"></span>
              Tôi đồng ý với các
              <a href="#" class="terms-link">điều khoản và điều kiện</a>
              của Funny Boy
            </label>
          </div>
        </div>

        <button
          type="submit"
          class="btn btn-primary register-button"
          [disabled]="isLoading"
        >
          <span *ngIf="isLoading" class="loading-spinner"></span>
          <i *ngIf="!isLoading" class="fas fa-user-plus"></i>
          {{ isLoading ? "Đang tạo tài khoản..." : "Đăng ký tài khoản" }}
        </button>

        <div class="divider">
          <span>hoặc</span>
        </div>

        <div class="login-link">
          <p>Đã có tài khoản?</p>
          <a [routerLink]="['/login']" class="login-btn">
            <i class="fas fa-sign-in-alt"></i>
            Đăng nhập ngay
          </a>
        </div>
      </form>
    </div>
  </div>
</div>
