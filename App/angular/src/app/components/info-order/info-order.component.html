<div class="container">
  <div class="info-order-section">
    <div class="page-header">
      <h2>Lịch sử đơn hàng</h2>
      <p class="subtitle">
        Theo dõi tình trạng và chi tiết các đơn hàng tại FUNNY BOY Coffee & Tea
      </p>
    </div>

    <!-- Loading state -->
    <div *ngIf="isLoading" class="loading-container">
      <div class="spinner-border" role="status">
        <span class="sr-only">Đang tải...</span>
      </div>
      <p>Đang tải thông tin đơn hàng...</p>
    </div>

    <!-- Orders list -->
    <div *ngIf="!isLoading && orders.length > 0" class="orders-list">
      <div
        class="order-card"
        *ngFor="let order of orders; trackBy: trackByOrderUuid"
      >
        <div class="order-header">
          <div class="order-info">
            <h4 class="order-uuid">
              Đơn hàng {{ order.order_uuid.substring(0, 5) }}
            </h4>
            <p class="order-date">
              {{ order.order_date | date : "dd/MM/yyyy HH:mm" }}
            </p>
          </div>
          <div class="order-status">
            <span class="status-badge" [ngClass]="getStatusClass(order.status)">
              {{ getStatusText(order.status) }}
            </span>
          </div>
        </div>

        <div class="order-content">
          <div class="order-summary">
            <div class="summary-item">
              <span class="label">Tổng tiền:</span>
              <span class="value total-amount"
                >{{ order.total_money | number }} VNĐ</span
              >
            </div>

            <div class="summary-item">
              <span class="label">Trạng thái đơn hàng:</span>
              <span
                class="value status-badge"
                [ngClass]="getStatusClass(order.status)"
              >
                {{ getStatusText(order.status) }}
              </span>
            </div>

            <div class="summary-item">
              <span class="label">Trạng thái thanh toán:</span>
              <span
                class="value status-badge"
                [ngClass]="getPaymentStatusClass(order.payment_status)"
              >
                {{ getPaymentStatusText(order.payment_status) }}
              </span>
            </div>

            <div class="summary-item">
              <span class="label">Phương thức thanh toán:</span>
              <span
                class="value"
                [ngClass]="getPaymentMethodClass(order.payment_method)"
              >
                <i [class]="getPaymentMethodIcon(order.payment_method)"></i>
                {{ getPaymentMethodText(order.payment_method) }}
              </span>
            </div>

            <div class="summary-item">
              <span class="label">Số sản phẩm:</span>
              <span class="value">{{ order.order_details.length }} món</span>
            </div>

            <div class="summary-item" *ngIf="order.note">
              <span class="label">Ghi chú:</span>
              <span class="value">{{ order.note }}</span>
            </div>
          </div>

          <div class="order-products">
            <h5>Sản phẩm đã đặt:</h5>
            <div class="product-list">
              <div
                class="product-item"
                *ngFor="let detail of order.order_details"
              >
                <img
                  [src]="detail.product_thumbnail"
                  [alt]="detail.product_name"
                  class="product-image"
                />
                <div class="product-info">
                  <h6 class="product-name">{{ detail.product_name }}</h6>
                  <p class="product-details">
                    Size: {{ detail.size }} | Số lượng: {{ detail.quantity }} |
                    {{ detail.unit_price | number }} VNĐ
                  </p>
                </div>
                <div class="product-total">
                  {{ detail.total_amount | number }} VNĐ
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="order-actions">
          <button class="btn btn-primary" (click)="viewOrderDetails(order)">
            <i class="fas fa-eye"></i>
            Xem chi tiết
          </button>

          <button
            class="btn btn-danger"
            (click)="handleCancelOrder(order)"
            [disabled]="!canCancelOrder(order.status)"
          >
            <i class="fas fa-times"></i>
            Hủy đơn hàng
          </button>
        </div>
      </div>
    </div>

    <!-- Empty state -->
    <div *ngIf="!isLoading && orders.length === 0" class="empty-state">
      <div class="empty-icon">
        <i class="fas fa-shopping-bag"></i>
      </div>
      <h3>Chưa có đơn hàng nào</h3>
      <p>Bạn chưa có đơn hàng nào. Hãy bắt đầu mua sắm ngay!</p>
      <button class="btn btn-primary" [routerLink]="['/']">
        <i class="fas fa-shopping-cart"></i>
        Bắt đầu mua sắm
      </button>
    </div>
  </div>

  <!-- Order Details Modal -->
  <div *ngIf="showOrderModal" class="modal-overlay" (click)="closeOrderModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Chi tiết đơn hàng</h3>
        <button class="close-btn" (click)="closeOrderModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body" *ngIf="selectedOrder">
        <!-- Order Basic Info -->
        <div class="order-detail-section">
          <h4><i class="fas fa-info-circle"></i> Thông tin đơn hàng</h4>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="label">Mã đơn hàng:</span>
              <span class="value">{{ selectedOrder.order_uuid }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Ngày đặt:</span>
              <span class="value">{{
                selectedOrder.order_date | date : "dd/MM/yyyy HH:mm"
              }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Trạng thái:</span>
              <span
                class="value status-badge"
                [ngClass]="getStatusClass(selectedOrder.status)"
              >
                {{ getStatusText(selectedOrder.status) }}
              </span>
            </div>
          </div>
        </div>

        <!-- Receiver Info -->
        <div class="order-detail-section">
          <h4><i class="fas fa-user"></i> Thông tin người nhận</h4>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="label">Họ tên:</span>
              <span class="value">{{
                selectedOrder.receiver_info.fullname
              }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Số điện thoại:</span>
              <span class="value">{{
                selectedOrder.receiver_info.phone_number
              }}</span>
            </div>
            <div class="detail-item full-width">
              <span class="label">Địa chỉ:</span>
              <span class="value">{{
                selectedOrder.receiver_info.address
              }}</span>
            </div>
          </div>
        </div>

        <!-- Payment & Shipping Info -->
        <div class="order-detail-section">
          <h4><i class="fas fa-credit-card"></i> Thanh toán & Vận chuyển</h4>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="label">Phương thức thanh toán:</span>
              <span
                class="value"
                [ngClass]="getPaymentMethodClass(selectedOrder.payment_method)"
              >
                <i
                  [class]="getPaymentMethodIcon(selectedOrder.payment_method)"
                ></i>
                {{ getPaymentMethodText(selectedOrder.payment_method) }}
              </span>
            </div>
            <div class="detail-item">
              <span class="label">Trạng thái thanh toán:</span>
              <span
                class="value"
                [ngClass]="getPaymentStatusClass(selectedOrder.payment_status)"
              >
                {{ getPaymentStatusText(selectedOrder.payment_status) }}
              </span>
            </div>
            <div class="detail-item">
              <span class="label">Phương thức vận chuyển:</span>
              <span class="value">{{ selectedOrder.shipping_method }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Đơn vị vận chuyển:</span>
              <span class="value">{{
                selectedOrder.provider || "Shopee Food"
              }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Tổng tiền:</span>
              <span class="value total-amount"
                >{{ selectedOrder.total_money | number }} VNĐ</span
              >
            </div>
          </div>
        </div>

        <!-- Order Note -->
        <div class="order-detail-section" *ngIf="selectedOrder.note">
          <h4><i class="fas fa-sticky-note"></i> Ghi chú</h4>
          <div class="note-content">
            {{ selectedOrder.note }}
          </div>
        </div>

        <!-- Order Details -->
        <div class="order-detail-section">
          <h4><i class="fas fa-list"></i> Chi tiết sản phẩm</h4>
          <div class="products-detail-list">
            <div
              class="product-detail-item"
              *ngFor="let detail of selectedOrder.order_details"
            >
              <img
                [src]="detail.product_thumbnail"
                [alt]="detail.product_name"
                class="product-detail-image"
              />
              <div class="product-detail-info">
                <h5 class="product-detail-name">{{ detail.product_name }}</h5>
                <div class="product-detail-specs">
                  <span class="spec-item">Size: {{ detail.size }}</span>
                  <span class="spec-item">Số lượng: {{ detail.quantity }}</span>
                  <span class="spec-item"
                    >Đơn giá: {{ detail.unit_price | number }} VNĐ</span
                  >
                </div>
              </div>
              <div class="product-detail-total">
                {{ detail.total_amount | number }} VNĐ
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeOrderModal()">
          <i class="fas fa-times"></i>
          Đóng
        </button>
        <button
          class="btn btn-danger"
          (click)="cancelOrderFromModal()"
          [disabled]="!canCancelOrder(selectedOrder?.status || '')"
        >
          <i class="fas fa-ban"></i>
          Hủy đơn hàng
        </button>
      </div>
    </div>
  </div>
</div>
