<div class="profile-page">
  <div class="profile-container">
    <div class="profile-wrapper">
      <!-- Header -->
      <div class="profile-header">
        <div class="brand-section">
          <h1 class="brand-title">FUNNY BOY</h1>
          <p class="brand-subtitle">Coffee & Tea</p>
        </div>
        <h2 class="profile-title">Đổi mật khẩu</h2>
        <p class="profile-subtitle">
          Thay đổi mật khẩu bảo mật tài khoản của bạn
        </p>
      </div>

      <!-- Change Password Form -->
      <div class="profile-content">
        <form
          (ngSubmit)="onSubmit()"
          #changePasswordForm="ngForm"
          class="profile-edit-form"
        >
          <!-- Old Password -->
          <div class="form-group">
            <label for="oldPassword" class="form-label">
              <i class="fas fa-key"></i>
              Mật khẩu hiện tại
            </label>
            <div class="input-wrapper">
              <input
                [type]="showOldPassword ? 'text' : 'password'"
                class="form-control"
                id="oldPassword"
                name="oldPassword"
                [(ngModel)]="formData.old_password"
                required
                #oldPassword="ngModel"
                [class.is-invalid]="
                  oldPassword.touched && !validateOldPasswordDTO.isValid
                "
                placeholder="Nhập mật khẩu hiện tại"
                (input)="validateOldPassword($event)"
              />
              <i class="fas fa-key input-icon"></i>
              <i
                class="fa-solid password-toggle"
                [class.fa-eye]="!showOldPassword"
                [class.fa-eye-slash]="showOldPassword"
                (click)="toggleOldPasswordVisibility()"
              ></i>
            </div>
            <div
              *ngIf="oldPassword.touched && !validateOldPasswordDTO.isValid"
              class="error-message"
            >
              <i class="fas fa-exclamation-circle"></i>
              <div *ngFor="let error of validateOldPasswordDTO.errors">
                {{ error }}
              </div>
            </div>
          </div>

          <!-- New Password -->
          <div class="form-group">
            <label for="newPassword" class="form-label">
              <i class="fas fa-lock"></i>
              Mật khẩu mới
            </label>
            <div class="input-wrapper">
              <input
                [type]="showNewPassword ? 'text' : 'password'"
                class="form-control"
                id="newPassword"
                name="newPassword"
                [(ngModel)]="formData.new_password"
                required
                #newPassword="ngModel"
                [class.is-invalid]="
                  newPassword.touched && !validateNewPasswordDTO.isValid
                "
                placeholder="Nhập mật khẩu mới (tối thiểu 12 ký tự)"
                (input)="validateNewPassword($event)"
              />
              <i class="fas fa-lock input-icon"></i>
              <i
                class="fa-solid password-toggle"
                [class.fa-eye]="!showNewPassword"
                [class.fa-eye-slash]="showNewPassword"
                (click)="toggleNewPasswordVisibility()"
              ></i>
            </div>
            <div
              *ngIf="newPassword.touched && !validateNewPasswordDTO.isValid"
              class="error-message"
            >
              <i class="fas fa-exclamation-circle"></i>
              <div *ngFor="let error of validateNewPasswordDTO.errors">
                {{ error }}
              </div>
            </div>
          </div>

          <!-- Confirm New Password -->
          <div class="form-group">
            <label for="confirmPassword" class="form-label">
              <i class="fas fa-lock"></i>
              Xác nhận mật khẩu mới
            </label>
            <div class="input-wrapper password-wrapper">
              <input
                [type]="showConfirmPassword ? 'text' : 'password'"
                class="form-control"
                id="confirmPassword"
                name="confirmPassword"
                [(ngModel)]="formData.confirmPassword"
                (input)="validateConfirmPassword($event)"
                required
                #confirmPassword="ngModel"
                [class.is-invalid]="
                  confirmPassword.touched && !validateConfirmPasswordDTO.isValid
                "
                placeholder="Nhập lại mật khẩu mới để xác nhận"
              />
              <i class="fas fa-lock input-icon"></i>
              <i
                class="fa-solid password-toggle"
                [class.fa-eye]="!showConfirmPassword"
                [class.fa-eye-slash]="showConfirmPassword"
                (click)="toggleConfirmPasswordVisibility()"
              ></i>
            </div>
            <div
              *ngIf="
                confirmPassword.touched && !validateConfirmPasswordDTO.isValid
              "
              class="error-message"
            >
              <i class="fas fa-exclamation-circle"></i>
              <div *ngFor="let error of validateConfirmPasswordDTO.errors">
                {{ error }}
              </div>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <button
              type="button"
              class="btn btn-secondary"
              (click)="onCancel()"
              [disabled]="isLoading"
            >
              <i class="fas fa-arrow-left"></i>
              Quay lại
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="isLoading"
            >
              <i class="fas fa-save" *ngIf="!isLoading"></i>
              <i class="fas fa-spinner fa-spin" *ngIf="isLoading"></i>
              {{ isLoading ? "Đang đổi..." : "Đổi mật khẩu" }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
