<div class="profile-page">
  <div class="profile-container">
    <div class="profile-wrapper" *ngIf="profile">
      <!-- Profile Header -->
      <div class="profile-header">
        <div class="brand-section">
          <h1 class="brand-title">FUNNY BOY</h1>
          <p class="brand-subtitle">Coffee & Tea</p>
        </div>
        <h2 class="profile-title">Thông tin cá nhân</h2>
        <p class="profile-subtitle">Quản lý thông tin tài khoản của bạn</p>
      </div>

      <!-- Profile Content -->
      <div class="profile-content">
        <!-- View Mode -->
        <div *ngIf="!isEditing" class="profile-view">
          <div class="profile-info-grid">
            <div class="info-item">
              <div class="info-label">
                <i class="fas fa-user"></i>
                Họ và tên
              </div>
              <div class="info-value">{{ profile.fullname }}</div>
            </div>

            <div class="info-item">
              <div class="info-label">
                <i class="fas fa-phone"></i>
                Số điện thoại
              </div>
              <div class="info-value">{{ profile.phone_number }}</div>
              <small class="info-note">Không thể thay đổi</small>
            </div>

            <div class="info-item">
              <div class="info-label">
                <i class="fas fa-calendar-alt"></i>
                Ngày sinh
              </div>
              <div class="info-value">
                {{ formatDateForDisplay(profile.date_of_birth) }}
              </div>
            </div>

            <div class="info-item">
              <div class="info-label">
                <i class="fas fa-map-marker-alt"></i>
                Địa chỉ
              </div>
              <div class="info-value">{{ profile.address }}</div>
            </div>
          </div>

          <div class="profile-actions">
            <button
              type="button"
              class="btn btn-primary"
              (click)="toggleEdit()"
            >
              <i class="fas fa-edit"></i>
              Chỉnh sửa thông tin
            </button>
          </div>
        </div>

        <!-- Edit Mode -->
        <form
          *ngIf="isEditing"
          (ngSubmit)="onSubmit()"
          #updateForm="ngForm"
          class="profile-edit-form"
        >
          <div class="form-group">
            <label for="fullname" class="form-label">
              <i class="fas fa-user"></i>
              Họ và tên
            </label>
            <div class="input-wrapper">
              <input
                type="text"
                class="form-control"
                id="fullname"
                name="fullname"
                [(ngModel)]="editData.fullname"
                required
                #fullname="ngModel"
                [class.is-invalid]="
                  fullname.touched && !validateFullNameDTO.isValid
                "
                placeholder="Nhập họ và tên đầy đủ"
                (input)="validateFullName($event)"
              />
              <i class="fas fa-user input-icon"></i>
            </div>
            <div
              *ngIf="fullname.touched && !validateFullNameDTO.isValid"
              class="error-message"
            >
              <i class="fas fa-exclamation-circle"></i>
              <div *ngFor="let error of validateFullNameDTO.errors">
                {{ error }}
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="dateOfBirth" class="form-label">
              <i class="fas fa-calendar-alt"></i>
              Ngày sinh (tùy chọn)
            </label>
            <div class="input-wrapper">
              <input
                type="date"
                class="form-control"
                id="dateOfBirth"
                name="dateOfBirth"
                [(ngModel)]="editData.dateOfBirth"
                #dateOfBirth="ngModel"
                [class.is-invalid]="
                  dateOfBirth.touched && !validateDateOfBirthDTO.isValid
                "
                (input)="validateDateOfBirth($event)"
              />
              <i class="fas fa-calendar-alt input-icon"></i>
            </div>
            <div
              *ngIf="dateOfBirth.touched && !validateDateOfBirthDTO.isValid"
              class="error-message"
            >
              <i class="fas fa-exclamation-circle"></i>
              <div *ngFor="let error of validateDateOfBirthDTO.errors">
                {{ error }}
              </div>
            </div>
          </div>

          <div class="form-group">
            <app-address-autocomplete
              [(ngModel)]="editData.address"
              name="address"
              #address="ngModel"
              [required]="true"
              [useCurrentLocation]="true"
              placeholder="Nhập địa chỉ đầy đủ của bạn"
              label="Địa chỉ"
              (addressSelected)="onAddressSelected($event)"
              (inputFocus)="validateAddress()"
            ></app-address-autocomplete>
            <div
              *ngIf="address.touched && !validateAddressDTO.isValid"
              class="error-message"
            >
              <i class="fas fa-exclamation-circle"></i>
              <div *ngFor="let error of validateAddressDTO.errors">
                {{ error }}
              </div>
            </div>
          </div>

          <!-- Read-only fields display -->
          <div class="readonly-fields">
            <div class="readonly-item">
              <div class="readonly-label">
                <i class="fas fa-phone"></i>
                Số điện thoại
              </div>
              <div class="readonly-value">{{ profile.phone_number }}</div>
              <small class="readonly-note">Không thể thay đổi</small>
            </div>
          </div>

          <div class="form-actions">
            <button
              type="button"
              class="btn btn-secondary"
              (click)="cancelEdit()"
              [disabled]="isLoading"
            >
              <i class="fas fa-times"></i>
              Hủy
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="isLoading"
            >
              <i class="fas fa-save" *ngIf="!isLoading"></i>
              <i class="fas fa-spinner fa-spin" *ngIf="isLoading"></i>
              {{ isLoading ? "Đang lưu..." : "Lưu thay đổi" }}
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Loading state -->
    <div *ngIf="!profile" class="loading-container">
      <div class="loading-spinner">
        <i class="fas fa-spinner fa-spin"></i>
      </div>
      <p>Đang tải thông tin...</p>
    </div>
  </div>
</div>
